

<!DOCTYPE html>


<html data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectral Energy Distribution (SED) Part 3: Bayesian Evidence and Model Selection &#8212; AIS 5201: AI In Astrophysics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter2/sed-3';</script>
    <link rel="canonical" href="https://USER.github.io/REPO/chapter2/sed-3.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Stellar Spectra Part 1: Observing Detailed Spectral Features" href="spectra-1.html" />
    <link rel="prev" title="Spectral Energy Distribution (SED) Part 2: Fitting SEDs" href="sed-2.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">AIS 5201: AI In Astrophysics</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction to AIS 5201
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter1/section_intro.html">Time-domain Data</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_1.html">Fitting Red Giant Oscillations Part 1: <em>Traditional Optimization</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_2.html">Fitting Red Giant Oscillations Part 2: <em>Flows &amp; Simulation-Based Inference</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/ps_statistics.html"><em>Power Spectrum Statistics</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_1.html">Eclipse Morphology Part 1: <em>Exploring and Preparing Data</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_2.html">Eclipse Morphology Part 2: <em>Low-Dimensional Representations</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_3.html">Eclipse Morphology Part 3: <em>Latent Spaces and Visualizing Them</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_4.html">Eclipse Morphology Part 4: <em>The Variational Autoencoder</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-1.html">Planetary Transits Part 1: <em>Observing Transits</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-2.html">Planetary Transits Part 2: <em>Classifying Transits</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-3.html">Planetary Transits Part 3: <em>Fitting a Transit Profile</em></a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="section_intro.html">Spectra</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sed-1.html">Spectral Energy Distribution (SED) Part 1: <em>Observing SEDs</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="sed-2.html">Spectral Energy Distribution (SED) Part 2: <em>Fitting SEDs</em></a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Spectral Energy Distribution (SED) Part 3: <em>Bayesian Evidence and Model Selection</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra-1.html">Stellar Spectra Part 1: <em>Observing Detailed Spectral Features</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra-2.html">Stellar Spectra Part 2: <em>The Cannon</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra-3.html">Stellar Spectra Part 3: <em>The Payne</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra-4.html">Stellar Spectra Part 4: <em>Detecting Stellar Activity Indicators</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="spectra-5.html">Stellar Spectra Part 5: <em>Domain Transfer</em></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter3/section_intro.html">Tabular Data</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/tabular-1.html">Grids of Stellar Models Part 1: <em>Stellar Parameter Regression</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/tabular-2.html">Grids of Stellar Models Part 2: <em>Interpolation</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/tabular-3.html">Catalogue Data Part 1: <em>Mixed Data Types</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/tabular-4.html">Catalogue Data Part 2: <em>Finding Clusters and Overdensities</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter3/tabular-5.html"><em>The Physics Informed Neural Network</em></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter4/section_intro.html">Images</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-1.html">Images Part 1: <em>Galaxy Merger Classification</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-2.html">Images Part 2: <em>Galaxy Morphology Classification</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-3.html">Images Part 3: <em>Self-Supervised Learning</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-4.html">Images Part 4: <em>Upscaling the Cosmic Web</em></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/docs/chapter2/sed-3.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/edit/master/docs/chapter2/sed-3.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter2/sed-3.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter2/sed-3.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spectral Energy Distribution (SED) Part 3: Bayesian Evidence and Model Selection</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#excess-flux-in-seds">Excess flux in SEDs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-component-sed-fitting">Two-component SED fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-model-evidence-from-bayes-theorem">Bayesian Model Evidence from Bayes’ Theorem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-evidence">Definition of Evidence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evidence-in-model-comparison">Evidence in Model Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-harmonic-mean-estimator-hme">The Harmonic Mean Estimator (HME)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-learned-harmonic-mean-estimator-lhme">The Learned Harmonic Mean Estimator (LHME)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See also</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spectral-energy-distribution-sed-part-3-bayesian-evidence-and-model-selection">
<span id="content-references-sed-part3"></span><h1>Spectral Energy Distribution (SED) Part 3: <em>Bayesian Evidence and Model Selection</em><a class="headerlink" href="#spectral-energy-distribution-sed-part-3-bayesian-evidence-and-model-selection" title="Permalink to this headline">#</a></h1>
<p><em><strong>Author: Marc Hon</strong></em></p>
<p>In this chapter, we will explore the use of machine learning to guide Bayesian model selection in fitting SEDs.</p>
<section id="excess-flux-in-seds">
<h2>Excess flux in SEDs<a class="headerlink" href="#excess-flux-in-seds" title="Permalink to this headline">#</a></h2>
<p>Close companions of stars, if sufficiently luminous, can pollute the incoming light expected from a source. Due to the finite angular resolution of telescopes, it is common that light measurements of astronomical sources may be <strong>blended</strong> with a nearby target, such that you measure the light from two or more sources.</p>
<figure class="align-default" id="unresolved">
<a class="reference internal image-reference" href="../_images/unresolved.png"><img alt="../_images/unresolved.png" src="../_images/unresolved.png" style="width: 800px; height: 200px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">An example of a binary system with an on-sky separation smaller than 0.5 arcseconds. Pesky! The two stars are only able to be resolved with a telescope with sufficient angular resolving power. Image from <a class="reference external" href="https://iopscience.iop.org/article/10.1088/0004-6256/144/2/42/pdf">Adams et al. (2012)</a></span><a class="headerlink" href="#unresolved" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>If the companion(s) to the primary source are sufficiently luminous, you may observe their flux contribution superimposed on the target source’s SED as a <strong>flux excess</strong>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">emcee</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">pyphot</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">astropy.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">import</span> <span class="nn">pysynphot</span> <span class="k">as</span> <span class="nn">S</span>
<span class="kn">import</span> <span class="nn">extinction</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">BlackBody</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">coordinates</span> <span class="k">as</span> <span class="n">coords</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">truncnorm</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>
<span class="kn">from</span> <span class="nn">isochrones.interp</span> <span class="kn">import</span> <span class="n">DFInterpolator</span>
<span class="kn">from</span> <span class="nn">extinction</span> <span class="kn">import</span> <span class="n">apply</span>


<span class="n">data_folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;ml_astro&#39;</span> <span class="o">/</span> <span class="s1">&#39;chapter2&#39;</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYSYN_CDBS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;science&#39;</span><span class="p">)</span>

<span class="n">fs</span> <span class="o">=</span> <span class="mi">18</span>

<span class="k">def</span> <span class="nf">mag_to_flux_AB</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate flux in erg s-1 cm-2 Hz-1.&quot;&quot;&quot;</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">mag</span> <span class="o">+</span> <span class="mf">48.6</span><span class="p">))</span>
    <span class="n">flux_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag_err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span>


<span class="k">def</span> <span class="nf">get_zero_flux</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Look for the filter information in the pyphot library of filters.&quot;&quot;&quot;</span>
    <span class="c1"># Load photometry filter library</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">pyphot</span><span class="o">.</span><span class="n">get_library</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>
    <span class="c1"># Get Vega zero flux in erg / cm2 / s / AA</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">Vega_zero_flux</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;erg/(AA * cm ** 2 * s)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">return</span> <span class="n">f0</span>


<span class="k">def</span> <span class="nf">get_effective_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get central wavelength of a specific filter in um.&quot;&quot;&quot;</span>
    <span class="c1"># Load photometry filter library</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">pyphot</span><span class="o">.</span><span class="n">get_library</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>
    <span class="c1"># Get central wavelength in um</span>
    <span class="n">leff</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">cl</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">return</span> <span class="n">leff</span>

<span class="k">def</span> <span class="nf">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert flux from erf s-1 cm-2 Hz-1 to erg s-1 cm-2 lambda-1.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">mag_to_flux</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from magnitude to flux.</span>

<span class="sd">    mag_to_flux performs the conversion from magnitude to flux in</span>
<span class="sd">    erg s-1 cm-2 AA-1.5</span>

<span class="sd">    The band parameter is a string representing the filter used and it must</span>
<span class="sd">    match exactly the name in pyphots filter database</span>

<span class="sd">    If the filter is from PanSTARRS or SDSS, then the magnitude is in the AB</span>
<span class="sd">    system. Else it&#39;s in the Vega system.</span>
<span class="sd">    </span>
<span class="sd">    Borrowed from https://github.com/jvines/astroARIADNE</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;PS1_&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s1">&#39;SDSS_&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s1">&#39;GALEX_&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="c1"># Get flux from AB mag</span>
        <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span> <span class="o">=</span> <span class="n">mag_to_flux_AB</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">)</span>
        <span class="c1"># Get effective wavelength for bandpass</span>
        <span class="n">leff</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
        <span class="c1"># Convert from f_nu to f_lambda in erg / cm2 / s / AA</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">leff</span><span class="p">)</span>
        <span class="n">flux_err</span> <span class="o">=</span> <span class="n">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">flux_err</span><span class="p">,</span> <span class="n">leff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get flux in erg / cm2 / s / AA</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">get_zero_flux</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span>
        <span class="n">flux_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag_err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/marc/anaconda3/lib/python3.8/site-packages/pysynphot/locations.py:46: UserWarning: PYSYN_CDBS is undefined; functionality will be SEVERELY crippled.
  warnings.warn(&quot;PYSYN_CDBS is undefined; functionality will be SEVERELY &quot;
/home/marc/anaconda3/lib/python3.8/site-packages/pysynphot/locations.py:345: UserWarning: Extinction files not found in extinction
  warnings.warn(&#39;Extinction files not found in %s&#39; % (extdir, ))
Holoviews not imported. Some visualizations will not be available.
PyMultiNest not imported.  MultiNest fits will not work.
</pre></div>
</div>
</div>
</div>
<p>Let’s proceed by loading in the SED of this source that looks suspiciously like it has an added contribution in the ultraviolet:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">,</span> <span class="s1">&#39;phot_data&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;/ms-wd.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;distance_pc&quot;</span><span class="p">]</span> <span class="c1"># Distance in parsec</span>

<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;band&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span> <span class="c1"># Extract band-wise values</span>
<span class="n">mags</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>
<span class="n">magerrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag_err&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Star ID: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;starname&quot;</span><span class="p">])</span> <span class="c1"># Star name </span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span> <span class="c1"># print band name and apparent magnitude and error</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Star ID:  TYC 6917-654-1
15.434659 0.0132691441 GALEX_FUV
14.7728844 0.006593926 GALEX_NUV
9.692 0.024 2MASS_J
9.367 0.023 2MASS_H
9.302 0.019 2MASS_Ks
10.714732 0.02 Gaia_G
11.024972 0.02 Gaia_BP
10.234925 0.02 Gaia_RP
11.481 0.08 TYCHO_B_MvB
10.862 0.075 TYCHO_V_MvB
9.268 0.023 WISE_RSR_W1
9.296 0.02 WISE_RSR_W2
9.278 0.042 WISE_RSR_W3
8.315 0.319 WISE_RSR_W4
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="n">n_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n_bands</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">band_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">merr</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
    <span class="n">f_</span><span class="p">,</span> <span class="n">f_err</span> <span class="o">=</span> <span class="n">mag_to_flux</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">mag_err</span> <span class="o">=</span> <span class="n">merr</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">f_err</span> <span class="o">+=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">f_</span>   <span class="c1"># Note: Inflating uncertainty</span>
    <span class="n">w_</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">band_colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">f_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">obs_flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_</span><span class="p">);</span> <span class="n">obs_flux_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_err</span><span class="p">);</span> <span class="n">obs_wav</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w_</span><span class="p">)</span>
    
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">240000</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">5700</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">);</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">bb</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="n">wav</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">3.25</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.035</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;Flux Excess?&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">obs_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_flux_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux_err</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bands</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_30688/3357671986.py:4: MatplotlibDeprecationWarning: The get_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps[name]`` or ``matplotlib.colormaps.get_cmap(obj)`` instead.
  cmap = cm.get_cmap(&#39;Spectral_r&#39;)
</pre></div>
</div>
<img alt="../_images/4fbd2158f1a68c5b0c228fd9faef915f0f10c7547cb4e89cc9c3e90bf472c098.png" src="../_images/4fbd2158f1a68c5b0c228fd9faef915f0f10c7547cb4e89cc9c3e90bf472c098.png" />
</div>
</div>
<p>Using an arbitrarily scaled black-body spectrum, we see that a typical star should experience a decrease in flux at shorter wavelengths. The rise in flux instead suggests the presence of another, hotter source. First, let us proceed as before and try fit this star with one SED.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Much of the code below follows from the implementation in the previous Section, and has thus been omitted for brevity.</p>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phot_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/CK09.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;met&#39;</span><span class="p">,</span> <span class="s1">&#39;teff&#39;</span><span class="p">,</span> <span class="s1">&#39;logg&#39;</span><span class="p">])</span>

<span class="n">interpolator</span> <span class="o">=</span> <span class="n">DFInterpolator</span><span class="p">(</span><span class="n">phot_grid</span><span class="p">)</span>
<span class="n">col_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phot_grid</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

<span class="k">def</span> <span class="nf">log_truncnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast log-probability of a truncated normal distribution.</span>
<span class="sd">    Equivalent to truncnorm.logpdf(x, a, b, loc=mu, scale=sigma)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Standardized bounds</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>

    <span class="c1"># CDF terms for normalization</span>
    <span class="n">cdf_a</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">cdf_b</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">cdf_b</span> <span class="o">-</span> <span class="n">cdf_a</span>

    <span class="c1"># Return -inf outside bounds</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">lower</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">upper</span> <span class="ow">or</span> <span class="n">norm</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Log-pdf of truncated normal</span>
    <span class="n">logp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logp</span>

<span class="k">def</span> <span class="nf">log_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast log-probability of a normal distribution.</span>
<span class="sd">    Equivalent to norm.logpdf(x, a, b, loc=mu, scale=sigma)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Standardized bounds</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="c1"># Log-pdf of truncated normal</span>
    <span class="n">logp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logp</span>

<span class="c1">######################   ONE MODEL FUNCTIONS ########################</span>

<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">theta</span>
    <span class="n">mu_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">;</span> <span class="n">sigma_dist</span> <span class="o">=</span> <span class="mi">1</span><span class="c1"># 10*dist_mu</span>
    <span class="n">mu_av</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sigma_av</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">theta</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-finite parameter:&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">&lt;</span> <span class="n">met</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">4000</span> <span class="o">&lt;</span> <span class="n">teff</span> <span class="o">&lt;</span> <span class="mi">6500</span> <span class="ow">and</span> <span class="mf">0.1</span> <span class="o">&lt;</span> <span class="n">rad</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="c1"># Truncated normal on distance</span>
    <span class="n">logp_dist</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu_dist</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">logp_av</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">Av</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_av</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_av</span><span class="p">,</span> 
                            <span class="n">lower</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">),</span> <span class="n">upper</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">))</span>
    <span class="n">logp_feh</span> <span class="o">=</span> <span class="n">log_norm</span><span class="p">(</span><span class="n">met</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=-</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.234</span><span class="p">)</span>
    <span class="n">logp_logg</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">logg</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logp_dist</span> <span class="o">+</span> <span class="n">logp_av</span> <span class="o">+</span> <span class="n">logp_feh</span> <span class="o">+</span> <span class="n">logp_logg</span>


<span class="k">def</span> <span class="nf">model_flux_emcee</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">params</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">([</span><span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">])</span> 
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">model</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">model</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="p">[</span><span class="n">col_to_idx</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">])</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">av_law</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">Av</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">)</span>

    <span class="k">return</span>  <span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model_flux_emcee</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">residuals</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">log_posterior</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">)</span>


<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">25000</span>

<span class="c1">############## ONE MODEL MCMC #################</span>

<span class="n">init_vals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;met&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;teff&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="s2">&quot;logg&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
    <span class="s2">&quot;rad&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
    <span class="s1">&#39;Av&#39;</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="p">}</span>

<span class="n">Rv</span> <span class="o">=</span> <span class="mf">3.1</span>
<span class="n">av_law</span> <span class="o">=</span> <span class="n">extinction</span><span class="o">.</span><span class="n">ccm89</span>
<span class="n">param_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;met&quot;</span><span class="p">,</span> <span class="s2">&quot;teff&quot;</span><span class="p">,</span>  <span class="s2">&quot;logg&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">]</span>
<span class="n">theta_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">init_vals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_order</span><span class="p">])</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_order</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">theta_init</span> <span class="o">+</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
<span class="n">logp_func</span> <span class="o">=</span> <span class="n">log_posterior</span>
<span class="n">args_func</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">)</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">logp_func</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="n">args_func</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running MCMC...&quot;</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampling complete.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running MCMC...
Sampling complete.
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="n">fs</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">soln_labels</span> <span class="o">=</span> <span class="n">param_order</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">soln_labels</span><span class="p">))</span> <span class="c1"># plotting the samples in a Corner plot!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c4cf01d9aef81f1fe75aa6de0ca2d5a65d81fb755b1fbd020e7cdaeaa1b75e30.png" src="../_images/c4cf01d9aef81f1fe75aa6de0ca2d5a65d81fb755b1fbd020e7cdaeaa1b75e30.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n_bands</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">band_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)}</span>

<span class="k">for</span> <span class="n">f_</span><span class="p">,</span> <span class="n">f_err</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
    <span class="n">w_</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">band_colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">f_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>


<span class="c1">### SAMPLES FROM POSTERIOR ####</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">[::</span><span class="mi">1000</span><span class="p">]:</span>
    <span class="n">optim_flux</span> <span class="o">=</span> <span class="n">model_flux_emcee</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">optim_flux</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">999</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior Samples&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/f5b25cbd3d4eebd37b9f5f533ed6bb5f24edddccc71b991ca41d306b4e6dfb96.png" src="../_images/f5b25cbd3d4eebd37b9f5f533ed6bb5f24edddccc71b991ca41d306b4e6dfb96.png" />
</div>
</div>
<p>As seen above, the one-component SED fits reasonably well, but it many standard deviations away from the GALEX FUV measurement. Can we do better with a two-component SED?</p>
<p>First, we need to make some assumptions about the nature of the secondary source. Given that it produces an excess flux in the UV, it is reasonable to assume that the second source is much hotter than primary (target) source, while being of comparable luminosity (otherwise the total flux will be dominated by the secondary).</p>
<figure class="align-default" id="hrd">
<a class="reference internal image-reference" href="../_images/hrd.png"><img alt="../_images/hrd.png" src="../_images/hrd.png" style="width: 850px; height: 500px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Our primary star is on the main sequence. What kind of star could be hotter, yet as luminous as the primary?</span><a class="headerlink" href="#hrd" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>For model spectra of the secondary, we will use the <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2010MmSAI..81..921K/abstract">Koester White Dwarf atmosphere models</a>, which should produce the desired contribution at shorter wavelengths as shown below.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wddf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/model_spectra/da10000_850.dk.dat.txt&quot;</span><span class="p">,</span>
                  <span class="n">skiprows</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;wave&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">])</span>

<span class="n">flux_conv</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">flux_conv2</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span>
<span class="n">ph_wav_lr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/model_spectra/lte05700-4.00-0.0.PHOENIX-ACES-AGSS-COND-2011-HiRes.fits&#39;</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ph_wav_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CRVAL1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ph_wav_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;NAXIS1&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">ph_wav_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;CDELT1&#39;</span><span class="p">],</span>
           <span class="n">ph_wav_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">flux_conv2</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">flux_conv</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Main Sequence Spectrum ($T_{</span><span class="se">\\</span><span class="s1">mathrm</span><span class="si">{eff}</span><span class="s1">}=5700$K, [M/H] = +0.0, $</span><span class="se">\\</span><span class="s1">log(g)=4.0</span><span class="se">\\</span><span class="s1">,$ dex)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wddf</span><span class="o">.</span><span class="n">wave</span><span class="p">,</span> <span class="n">wddf</span><span class="o">.</span><span class="n">flux</span><span class="o">*</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;White Dwarf Spectrum  ($T_{</span><span class="se">\\</span><span class="s1">mathrm</span><span class="si">{eff}</span><span class="s1">}=10000$K, $</span><span class="se">\\</span><span class="s1">log(g)=8.5</span><span class="se">\\</span><span class="s1">,$ dex)&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/fb7d507246e823e4b9d57b5902f906fdc09d507235864b6d10bf1724b0c8b715.png" src="../_images/fb7d507246e823e4b9d57b5902f906fdc09d507235864b6d10bf1724b0c8b715.png" />
</div>
</div>
<p>We will now introduce a pre-computed, interpolatable grid of synthetic white dwarf photometry.</p>
<div class="tip admonition">
<p class="admonition-title">Missing a parameter?</p>
<p>Why do the white dwarf models not have a dependence on metallicity?</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_wd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/Koester_Extended_Flam.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;teff&#39;</span><span class="p">,</span> <span class="s1">&#39;logg&#39;</span><span class="p">])</span>
<span class="n">interpolator_wd</span> <span class="o">=</span> <span class="n">DFInterpolator</span><span class="p">(</span><span class="n">models_wd</span><span class="p">)</span>
<span class="n">col_to_idx_wd</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">models_wd</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span> <span class="c1"># align observed photometry with grid columns</span>
<span class="n">models_wd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>2MASS_J</th>
      <th>2MASS_H</th>
      <th>2MASS_Ks</th>
      <th>GALEX_NUV</th>
      <th>GALEX_FUV</th>
      <th>SDSS_u</th>
      <th>SDSS_g</th>
      <th>SDSS_r</th>
      <th>SDSS_i</th>
      <th>SDSS_z</th>
      <th>...</th>
      <th>Gaia_BP</th>
      <th>Gaia_RP</th>
      <th>TYCHO_B_MvB</th>
      <th>TYCHO_V_MvB</th>
      <th>PS1_g</th>
      <th>PS1_r</th>
      <th>PS1_i</th>
      <th>PS1_z</th>
      <th>PS1_w</th>
      <th>PS1_y</th>
    </tr>
    <tr>
      <th>teff</th>
      <th>logg</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">5000</th>
      <th>6.50</th>
      <td>1.414507e+06</td>
      <td>7.374659e+05</td>
      <td>3.118352e+05</td>
      <td>6.164364e+04</td>
      <td>1.563648e+02</td>
      <td>1.855429e+06</td>
      <td>3.690910e+06</td>
      <td>3.896803e+06</td>
      <td>3.359901e+06</td>
      <td>2.633431e+06</td>
      <td>...</td>
      <td>3.723901e+06</td>
      <td>3.143137e+06</td>
      <td>3.122570e+06</td>
      <td>3.957883e+06</td>
      <td>3.786901e+06</td>
      <td>3.880716e+06</td>
      <td>3.337646e+06</td>
      <td>2.772187e+06</td>
      <td>3.624643e+06</td>
      <td>2.334344e+06</td>
    </tr>
    <tr>
      <th>6.75</th>
      <td>1.417164e+06</td>
      <td>7.368323e+05</td>
      <td>3.116441e+05</td>
      <td>5.785754e+04</td>
      <td>1.572774e+02</td>
      <td>1.795558e+06</td>
      <td>3.695300e+06</td>
      <td>3.912865e+06</td>
      <td>3.374172e+06</td>
      <td>2.643324e+06</td>
      <td>...</td>
      <td>3.730633e+06</td>
      <td>3.155777e+06</td>
      <td>3.102240e+06</td>
      <td>3.973049e+06</td>
      <td>3.795108e+06</td>
      <td>3.896819e+06</td>
      <td>3.351787e+06</td>
      <td>2.782912e+06</td>
      <td>3.638457e+06</td>
      <td>2.342451e+06</td>
    </tr>
    <tr>
      <th>7.00</th>
      <td>1.419743e+06</td>
      <td>7.366677e+05</td>
      <td>3.115975e+05</td>
      <td>5.456274e+04</td>
      <td>1.573485e+02</td>
      <td>1.734089e+06</td>
      <td>3.698220e+06</td>
      <td>3.927722e+06</td>
      <td>3.386926e+06</td>
      <td>2.652096e+06</td>
      <td>...</td>
      <td>3.735921e+06</td>
      <td>3.167116e+06</td>
      <td>3.078814e+06</td>
      <td>3.987306e+06</td>
      <td>3.802031e+06</td>
      <td>3.911677e+06</td>
      <td>3.364416e+06</td>
      <td>2.792420e+06</td>
      <td>3.650898e+06</td>
      <td>2.349640e+06</td>
    </tr>
    <tr>
      <th>7.25</th>
      <td>1.422192e+06</td>
      <td>7.367574e+05</td>
      <td>3.116378e+05</td>
      <td>5.153634e+04</td>
      <td>1.564889e+02</td>
      <td>1.675158e+06</td>
      <td>3.699813e+06</td>
      <td>3.941893e+06</td>
      <td>3.398580e+06</td>
      <td>2.660065e+06</td>
      <td>...</td>
      <td>3.740264e+06</td>
      <td>3.177594e+06</td>
      <td>3.053613e+06</td>
      <td>4.000623e+06</td>
      <td>3.807712e+06</td>
      <td>3.925764e+06</td>
      <td>3.375955e+06</td>
      <td>2.801054e+06</td>
      <td>3.662337e+06</td>
      <td>2.356182e+06</td>
    </tr>
    <tr>
      <th>7.50</th>
      <td>1.424604e+06</td>
      <td>7.369246e+05</td>
      <td>3.117092e+05</td>
      <td>4.876510e+04</td>
      <td>1.546710e+02</td>
      <td>1.619703e+06</td>
      <td>3.699973e+06</td>
      <td>3.955537e+06</td>
      <td>3.409192e+06</td>
      <td>2.667294e+06</td>
      <td>...</td>
      <td>3.743723e+06</td>
      <td>3.187307e+06</td>
      <td>3.026983e+06</td>
      <td>4.012868e+06</td>
      <td>3.812023e+06</td>
      <td>3.939218e+06</td>
      <td>3.386459e+06</td>
      <td>2.808880e+06</td>
      <td>3.672827e+06</td>
      <td>2.362128e+06</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">80000</th>
      <th>8.50</th>
      <td>4.863153e+07</td>
      <td>1.575104e+07</td>
      <td>5.369899e+06</td>
      <td>3.078367e+10</td>
      <td>1.301025e+11</td>
      <td>5.899452e+09</td>
      <td>2.112044e+09</td>
      <td>7.369602e+08</td>
      <td>3.488528e+08</td>
      <td>1.746400e+08</td>
      <td>...</td>
      <td>1.658623e+09</td>
      <td>3.144257e+08</td>
      <td>3.236899e+09</td>
      <td>1.358082e+09</td>
      <td>1.885040e+09</td>
      <td>7.289167e+08</td>
      <td>3.407710e+08</td>
      <td>1.956701e+08</td>
      <td>7.680077e+08</td>
      <td>1.300543e+08</td>
    </tr>
    <tr>
      <th>8.75</th>
      <td>4.843354e+07</td>
      <td>1.569018e+07</td>
      <td>5.347963e+06</td>
      <td>3.067968e+10</td>
      <td>1.297185e+11</td>
      <td>5.877385e+09</td>
      <td>2.101370e+09</td>
      <td>7.339597e+08</td>
      <td>3.476120e+08</td>
      <td>1.739954e+08</td>
      <td>...</td>
      <td>1.651131e+09</td>
      <td>3.131610e+08</td>
      <td>3.221087e+09</td>
      <td>1.351882e+09</td>
      <td>1.875792e+09</td>
      <td>7.260037e+08</td>
      <td>3.395599e+08</td>
      <td>1.949524e+08</td>
      <td>7.646885e+08</td>
      <td>1.295653e+08</td>
    </tr>
    <tr>
      <th>9.00</th>
      <td>4.825342e+07</td>
      <td>1.563465e+07</td>
      <td>5.328444e+06</td>
      <td>3.059636e+10</td>
      <td>1.294229e+11</td>
      <td>5.858660e+09</td>
      <td>2.091656e+09</td>
      <td>7.312530e+08</td>
      <td>3.465395e+08</td>
      <td>1.734405e+08</td>
      <td>...</td>
      <td>1.644428e+09</td>
      <td>3.120360e+08</td>
      <td>3.207282e+09</td>
      <td>1.346188e+09</td>
      <td>1.867363e+09</td>
      <td>7.233848e+08</td>
      <td>3.385133e+08</td>
      <td>1.943357e+08</td>
      <td>7.617003e+08</td>
      <td>1.291421e+08</td>
    </tr>
    <tr>
      <th>9.25</th>
      <td>4.809952e+07</td>
      <td>1.558632e+07</td>
      <td>5.310709e+06</td>
      <td>3.053349e+10</td>
      <td>1.292259e+11</td>
      <td>5.843778e+09</td>
      <td>2.083049e+09</td>
      <td>7.288360e+08</td>
      <td>3.456306e+08</td>
      <td>1.729724e+08</td>
      <td>...</td>
      <td>1.638609e+09</td>
      <td>3.110413e+08</td>
      <td>3.195699e+09</td>
      <td>1.341108e+09</td>
      <td>1.859889e+09</td>
      <td>7.210561e+08</td>
      <td>3.376275e+08</td>
      <td>1.938154e+08</td>
      <td>7.590640e+08</td>
      <td>1.287848e+08</td>
    </tr>
    <tr>
      <th>9.50</th>
      <td>4.796485e+07</td>
      <td>1.554476e+07</td>
      <td>5.294563e+06</td>
      <td>3.048803e+10</td>
      <td>1.291087e+11</td>
      <td>5.831889e+09</td>
      <td>2.075350e+09</td>
      <td>7.266981e+08</td>
      <td>3.448563e+08</td>
      <td>1.725594e+08</td>
      <td>...</td>
      <td>1.633536e+09</td>
      <td>3.101489e+08</td>
      <td>3.185992e+09</td>
      <td>1.336572e+09</td>
      <td>1.853203e+09</td>
      <td>7.190051e+08</td>
      <td>3.368719e+08</td>
      <td>1.933565e+08</td>
      <td>7.567306e+08</td>
      <td>1.284695e+08</td>
    </tr>
  </tbody>
</table>
<p>1066 rows × 28 columns</p>
</div></div></div>
</div>
</section>
<section id="two-component-sed-fitting">
<h2>Two-component SED fitting<a class="headerlink" href="#two-component-sed-fitting" title="Permalink to this headline">#</a></h2>
<p>We will assume that the total flux is the combined sum of the two stars (subscripts 1 and 2):</p>
<div class="math notranslate nohighlight">
\[
F_{\mathrm{obs}}(\lambda) = F_{1}(\lambda) \times D_1 \times 10^{-0.4 A_1(\lambda)} + F_{2}(\lambda) \times D_2 \times 10^{-0.4 A_2(\lambda)},
\]</div>
<p>Assuming that these two stars are in a binary system, they are physically at the same distance, and therefore <span class="math notranslate nohighlight">\(A_1 = A_2\)</span> and <span class="math notranslate nohighlight">\(d_1 = d_2\)</span>. The above then reduces to:</p>
<div class="math notranslate nohighlight">
\[
F_{\mathrm{obs}}(\lambda) = \frac{10^{-0.4 A_1(\lambda)}}{d}(F_{1}(\lambda) \times R_1 + F_{2}(\lambda) \times R_2).
\]</div>
<p>The following code rewrites the MCMC fitting procedures for the two-component SED case:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some important notes about the fitting:</p>
<ul class="simple">
<li><p>The sampling of the radius of the white dwarf is done in log units. This is because such stars are typically about 10% of the size of main-sequence stars, and using a log transform gives the sampling more dynamic range.</p></li>
<li><p>The Koester white dwarf models do not extend far into the infrared, while the CK09 models do. This means we do not have synthetic photometry for the WISE W1-4 bands. Therefore, we make the assumption that the white dwarf contributes a zero amount of flux in these bands, which is a reasonable approximation.</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">######################  TWO MODEL FUNCTIONS  ########################</span>

<span class="k">def</span> <span class="nf">log_prior_twomodel</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">met1</span><span class="p">,</span> <span class="n">teff1</span><span class="p">,</span> <span class="n">logg1</span><span class="p">,</span> <span class="n">rad1</span><span class="p">,</span> <span class="n">teff2</span><span class="p">,</span> <span class="n">logg2</span><span class="p">,</span> <span class="n">lograd2</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">theta</span>
    <span class="n">mu_dist</span> <span class="o">=</span> <span class="n">dist</span><span class="p">;</span> <span class="n">sigma_dist</span> <span class="o">=</span> <span class="mi">1</span><span class="c1"># 10*dist_mu</span>
    <span class="n">mu_av</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sigma_av</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">theta</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-finite parameter:&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">&lt;</span> <span class="n">met1</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">4000</span> <span class="o">&lt;</span> <span class="n">teff1</span> <span class="o">&lt;</span> <span class="mi">6500</span> <span class="ow">and</span> <span class="mf">0.1</span> <span class="o">&lt;</span> <span class="n">rad1</span> <span class="o">&lt;</span> <span class="mf">1.5</span>\
           <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">lograd2</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">logp_dist</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu_dist</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">logp_av</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">Av</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_av</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_av</span><span class="p">,</span> 
                            <span class="n">lower</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">),</span> <span class="n">upper</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">))</span>
    <span class="n">logp_feh</span> <span class="o">=</span> <span class="n">log_norm</span><span class="p">(</span><span class="n">met1</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=-</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.234</span><span class="p">)</span>
    <span class="n">logp_logg1</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">logg1</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">logp_logg2</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">logg2</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">9.5</span><span class="p">)</span>
    <span class="n">logp_teff2</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">teff2</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">80000</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logp_dist</span> <span class="o">+</span> <span class="n">logp_av</span> <span class="o">+</span> <span class="n">logp_feh</span> <span class="o">+</span> <span class="n">logp_logg1</span> <span class="o">+</span> <span class="n">logp_logg2</span> <span class="o">+</span> <span class="n">logp_teff2</span>


<span class="k">def</span> <span class="nf">model_flux_emcee_twomodel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span><span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">,</span> <span class="n">return_models</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">met1</span><span class="p">,</span> <span class="n">teff1</span><span class="p">,</span> <span class="n">logg1</span><span class="p">,</span> <span class="n">rad1</span><span class="p">,</span> <span class="n">teff2</span><span class="p">,</span> <span class="n">logg2</span><span class="p">,</span> <span class="n">lograd2</span><span class="p">,</span> <span class="n">d_</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">params</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">([</span><span class="n">met1</span><span class="p">,</span> <span class="n">teff1</span><span class="p">,</span> <span class="n">logg1</span><span class="p">])</span> 
    <span class="n">model_wd</span> <span class="o">=</span> <span class="n">interpolator_wd</span><span class="p">([</span><span class="n">teff2</span><span class="p">,</span> <span class="n">logg2</span><span class="p">])</span> 
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">model</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">model</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="p">[</span><span class="n">col_to_idx</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">])</span>
    <span class="n">model_wd</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model_wd</span><span class="p">[</span><span class="n">col_to_idx_wd</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]])</span> <span class="c1"># No WISE</span>
    <span class="n">model_wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_wd</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rad1</span> <span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lograd2</span> <span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">d_</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span><span class="p">)</span>
    <span class="n">norm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">r1</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">norm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">ext</span> <span class="o">=</span> <span class="n">av_law</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">Av</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">return_models</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">norm1</span><span class="o">*</span> <span class="p">(</span><span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model</span><span class="p">)),</span> <span class="n">norm2</span><span class="o">*</span><span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model_wd</span><span class="p">)</span>

    <span class="k">return</span>  <span class="p">(</span><span class="n">norm1</span><span class="o">*</span> <span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="n">norm2</span><span class="o">*</span><span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model_wd</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">log_likelihood_twomodel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model_flux_emcee_twomodel</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">residuals</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">log_posterior_twomodel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">):</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">log_prior_twomodel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">log_likelihood_twomodel</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Initializing and fitting the two-component model as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ############## TWO MODEL #################</span>
<span class="n">init_vals_twomodel</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;met1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;teff1&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="s2">&quot;logg1&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
    <span class="s2">&quot;rad1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;teff2&quot;</span><span class="p">:</span> <span class="mi">25000</span><span class="p">,</span>
    <span class="s2">&quot;logg2&quot;</span><span class="p">:</span> <span class="mf">7.5</span><span class="p">,</span>
    <span class="s2">&quot;lograd2&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
    <span class="s1">&#39;Av&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">param_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;met1&quot;</span><span class="p">,</span> <span class="s2">&quot;teff1&quot;</span><span class="p">,</span>  <span class="s2">&quot;logg1&quot;</span><span class="p">,</span> <span class="s2">&quot;rad1&quot;</span><span class="p">,</span>  <span class="s2">&quot;teff2&quot;</span><span class="p">,</span>  <span class="s2">&quot;logg2&quot;</span><span class="p">,</span> <span class="s2">&quot;lograd2&quot;</span><span class="p">,</span>
               <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">]</span>
<span class="n">theta_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">init_vals_twomodel</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_order</span><span class="p">])</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_order</span><span class="p">)</span>
<span class="n">p0</span> <span class="o">=</span> <span class="n">theta_init</span> <span class="o">+</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
<span class="n">logp_func</span> <span class="o">=</span> <span class="n">log_posterior_twomodel</span>
<span class="n">args_func</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">)</span>


<span class="n">sampler_twocomp</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">logp_func</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="n">args_func</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running MCMC...&quot;</span><span class="p">)</span>
<span class="n">sampler_twocomp</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampling complete.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running MCMC...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|████████████████████████████████████| 25000/25000 [03:18&lt;00:00, 126.03it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sampling complete.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples_twocomp</span> <span class="o">=</span> <span class="n">sampler_twocomp</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">soln_labels_twocomp</span> <span class="o">=</span> <span class="n">param_order</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">samples_twocomp</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">soln_labels_twocomp</span><span class="p">))</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c4891528825838df53f329306f0b725f40aa775d01c1427ac62e8769c3eb5460.png" src="../_images/c4891528825838df53f329306f0b725f40aa775d01c1427ac62e8769c3eb5460.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">),</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>

<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n_bands</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">band_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)}</span>

    
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">f_</span><span class="p">,</span> <span class="n">f_err</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
        <span class="n">w_</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> 
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">f_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">band_colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Posterior Samples&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span>

<span class="n">of1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">of2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">### SAMPLES FROM POSTERIOR ####</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">samples_twocomp</span><span class="p">[::</span><span class="mi">1000</span><span class="p">]:</span>
    <span class="n">optim_flux1</span><span class="p">,</span> <span class="n">optim_flux2</span> <span class="o">=</span> <span class="n">model_flux_emcee_twomodel</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">,</span> <span class="n">interpolator_wd</span><span class="p">,</span>
                                                        <span class="n">return_models</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">of1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optim_flux1</span><span class="p">)</span>
    <span class="n">of2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optim_flux2</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">optim_flux1</span> <span class="o">+</span> <span class="n">optim_flux2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">999</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">of1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Component 1&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">of2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Component 2&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">of1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">of2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">99</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Component 1 + 2&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/6b52857124e319462d531ace703a7d62d2ceb19ed2408999061f5fbee84db6ef.png" src="../_images/6b52857124e319462d531ace703a7d62d2ceb19ed2408999061f5fbee84db6ef.png" />
</div>
</div>
</section>
<section id="bayesian-model-evidence-from-bayes-theorem">
<h2>Bayesian Model Evidence from Bayes’ Theorem<a class="headerlink" href="#bayesian-model-evidence-from-bayes-theorem" title="Permalink to this headline">#</a></h2>
<p>Bayes’ theorem for a model <span class="math notranslate nohighlight">\( M \)</span> with parameters <span class="math notranslate nohighlight">\( \theta \)</span> and observed data <span class="math notranslate nohighlight">\( y \)</span> is:</p>
<div class="math notranslate nohighlight">
\[
p(\theta \mid y, M) = \frac{p(y \mid \theta, M) \, p(\theta \mid M)}{p(y \mid M)}.
\]</div>
<p>This expresses the posterior as a product of the likelihood and the prior, normalized by the <strong>model evidence</strong> (also called the <strong>marginal likelihood</strong>):</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( p(\theta \mid y, M) \)</span>: posterior distribution</p></li>
<li><p><span class="math notranslate nohighlight">\( p(y \mid \theta, M) \)</span>: likelihood</p></li>
<li><p><span class="math notranslate nohighlight">\( p(\theta \mid M) \)</span>: prior</p></li>
<li><p><span class="math notranslate nohighlight">\( p(y \mid M) \)</span>: model evidence</p></li>
</ul>
<p>An equivalent notation commonly used in Bayesian computation is:</p>
<div class="math notranslate nohighlight">
\[
p(\theta \mid y, M) = \frac{\mathcal{L}(\theta) \, \pi(\theta)}{z},
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( \mathcal{L}(\theta) := p(y \mid \theta, M) \)</span> is the likelihood,</p></li>
<li><p><span class="math notranslate nohighlight">\( \pi(\theta) := p(\theta \mid M) \)</span> is the prior,</p></li>
<li><p><span class="math notranslate nohighlight">\( z := p(y \mid M) \)</span> is the marginal likelihood (evidence).</p></li>
</ul>
<section id="definition-of-evidence">
<h3>Definition of Evidence<a class="headerlink" href="#definition-of-evidence" title="Permalink to this headline">#</a></h3>
<div class="math notranslate nohighlight">
\[
p(y \mid M) = z = \int p(y \mid \theta, M) \, p(\theta \mid M) \, d\theta.
\]</div>
<p>The model evidence is the integral of the joint likelihood and prior <strong>over the parameter space</strong>. It quantifies both how well the model explains the data <em>and</em> how plausible that explanation is under the prior.</p>
<p>This integral captures both the fit of the model to the data and the complexity of the model. Models that overfit tend to have higher likelihoods on a narrow region of parameter space, leading to smaller integrals. As such, Bayesian model selection automatically <strong>penalizes model complexity</strong>.</p>
<figure class="align-default" id="occam">
<a class="reference internal image-reference" href="../_images/occam.png"><img alt="../_images/occam.png" src="../_images/occam.png" style="width: 600px; height: 400px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Schematic of Bayesian model evidence. A simpler model concentrates prior mass on fewer datasets (higher prior predictive probability per dataset), while a complex model spreads prior mass over many datasets (lower prior predictive probability per dataset). In other words, a complex model has the potential of fitting many different types of datasets prior to fitting. Image from <a class="reference external" href="https://royalsocietypublishing.org/doi/10.1098/rsta.2011.0553">Ghahramani (2013)</a>.</span><a class="headerlink" href="#occam" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="evidence-in-model-comparison">
<h3>Evidence in Model Comparison<a class="headerlink" href="#evidence-in-model-comparison" title="Permalink to this headline">#</a></h3>
<p>Bayesian model comparison is performed by computing the evidence for each model and comparing their relative probabilities:</p>
<div class="math notranslate nohighlight">
\[
\frac{p(M_1 \mid y)}{p(M_2 \mid y)} = \frac{p(y \mid M_1)}{p(y \mid M_2)} \cdot \frac{p(M_1)}{p(M_2)}.
\]</div>
<div class="tip admonition">
<p class="admonition-title">Another approach to defining Bayesian model comparison</p>
<p>For a set of models <span class="math notranslate nohighlight">\( \{ {M}_i \} \)</span>, Bayes’ theorem yields the posterior probability of each candidate model given observed data <span class="math notranslate nohighlight">\( y \)</span>:</p>
<div class="math notranslate nohighlight">
\[
p({M}_i \mid y) = \frac{p(y \mid {M}_i) \, p({M}_i)}{p(y)},
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( p({M}_i) \)</span> is the prior probability of model <span class="math notranslate nohighlight">\( {M}_i \)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\( p(x \mid {M}_i) \)</span> is the marginal likelihood or <strong>model evidence</strong>, and</p></li>
<li><p><span class="math notranslate nohighlight">\( p(x) = \sum_j p(y \mid {M}_j) p({M}_j) \)</span> is the model-normalizing constant.</p></li>
</ul>
<p>When comparing two models <span class="math notranslate nohighlight">\( {M}_1 \)</span> and <span class="math notranslate nohighlight">\( {M}_2 \)</span>, the ratio of their posterior probabilities is:</p>
<div class="math notranslate nohighlight">
\[
\frac{p({M}_1 \mid y)}{p({M}_2 \mid y)} = \frac{p(y \mid {M}_1)}{p(y \mid {M}_2)} \cdot \frac{p({M}_1)}{p({M}_2)},
\]</div>
<p>which indicates that model selection depends both on how well the model explains the data and the prior belief in the model.</p>
</div>
</section>
</section>
<section id="the-harmonic-mean-estimator-hme">
<h2>The Harmonic Mean Estimator (HME)<a class="headerlink" href="#the-harmonic-mean-estimator-hme" title="Permalink to this headline">#</a></h2>
<p>Introduced by <a class="reference external" href="https://www.jstor.org/stable/2346025">Newton and Rafterty (1994)</a>, the HME is a simple approach for estimating model evidence and enabling model comparisons. From Bayes’ theorem, we have</p>
<div class="math notranslate nohighlight">
\[
p(\theta \mid y) = \frac{\mathcal{L}(\theta)\, \pi(\theta)}{z}. 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{L}(\theta)\)</span> is the likelihood and <span class="math notranslate nohighlight">\(\pi(\theta)\)</span> is the prior. We aim to estimate the model evidence <span class="math notranslate nohighlight">\( z = p(y) \)</span> given posterior samples. Let us draw samples from the posterior and compute the inverse of the likelihood:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}_{p(\theta \mid y)}\left[ \frac{1}{\mathcal{L}(\theta)} \right]
= \int \frac{1}{\mathcal{L}(\theta)} \, p(\theta \mid y) \, d\theta.
\]</div>
<p>Note the following:</p>
<div class="math notranslate nohighlight">
\[
\int \frac{1}{\mathcal{L}(\theta)} \, p(\theta \mid y) \, d\theta = \int \frac{1}{\mathcal{L}(\theta)} \cdot \frac{\mathcal{L}(\theta)\, \pi(\theta)}{z} \, d\theta = \frac{1}{z} \int \pi(\theta) \, d\theta = \frac{1}{z},
\]</div>
<p>since <span class="math notranslate nohighlight">\( \pi(\theta) \)</span> is a normalized prior distribution.
Given samples <span class="math notranslate nohighlight">\( \{ \theta_j \}_{j=1}^N \)</span> drawn from the posterior distribution <span class="math notranslate nohighlight">\( p(\theta \mid y) \)</span>, the harmonic mean estimator <span class="math notranslate nohighlight">\( \hat{z}_{\text{HME}} \)</span> provides an approximation of the model evidence as the following:</p>
<div class="math notranslate nohighlight">
\[
\hat{z}_{\text{HME}} = \left( \frac{1}{N} \sum_{i=1}^N \frac{1}{\mathcal{L}(\theta_i)} \right)^{-1},
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> is the likelihood. Rewriting this differently:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{\hat{z}_{\text{HME}}} = \int \frac{p(\theta \mid y) }{\mathcal{L}(\theta)}\,d\theta.
\]</div>
<p>The HME thus <strong>requires only posterior samples and evaluations of the likelihood.</strong></p>
<p>However, it may be unreliable in high-dimensional settings or when the posterior is weakly concentrated. In these scenarios, the estimator can place disproportionate weight on samples where the likelihood <span class="math notranslate nohighlight">\(\mathcal{L} \)</span> is small, which blows up the quantity <span class="math notranslate nohighlight">\(\hat{z}_{\text{HME}}\)</span>. Because of this, the HME is thought to suffer from <strong>high variance</strong>.</p>
<div class="tip admonition">
<p class="admonition-title">HME in the context of importance sampling</p>
<p>Compare this with the importance sampling identity, which states:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}_{q(\theta)}\left[ \frac{k(\theta)}{q(\theta)} f(\theta) \right] = \int f(\theta) \, k(\theta) \, d\theta.
\]</div>
<p>We see that <span class="math notranslate nohighlight">\( 1/p(y \mid M) \)</span> is equivalent to the expectation of the <strong>reciprocal likelihood</strong> under the posterior:</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{\hat{z}_{\text{HME}}} = \int \frac{1}{z} \frac{\pi(\theta)}{p(\theta \mid y)}\,p(\theta \mid y)\,d\theta.
\]</div>
<p>Thus, the Harmonic Mean Estimator is a form of importance sampling where:</p>
<ul class="simple">
<li><p>The <strong>target distribution</strong> <span class="math notranslate nohighlight">\(k(\theta)\)</span>  is the prior <span class="math notranslate nohighlight">\(\pi(\theta) \)</span>,</p></li>
<li><p>The <strong>proposal distribution</strong> <span class="math notranslate nohighlight">\(k(\theta)\)</span> is the posterior <span class="math notranslate nohighlight">\( p(\theta \mid y) \)</span>,</p></li>
</ul>
<p>This equivalence reveals the key weakness: in importance sampling you need to have your proposal distribution to span a wider range in parameter space (i.e., fatter tails) than the target distribution. This is often not the case for the above definition of the prior as the target and the posterior as the proposal. As a result, the HME is said to contain a large variance, by placing too much emphasis on parameter values where the likelihood is small, even if those values are sampled infrequently under the posterior.</p>
</div>
</section>
<section id="the-learned-harmonic-mean-estimator-lhme">
<h2>The Learned Harmonic Mean Estimator (LHME)<a class="headerlink" href="#the-learned-harmonic-mean-estimator-lhme" title="Permalink to this headline">#</a></h2>
<p>Generalizing the importance sampling definition of the harmonic mean estimator, we have</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{\hat{z}} = \int \frac{1}{z} \frac{\psi(\theta)}{p(\theta \mid y)}\,p(\theta \mid y)\,d\theta,
\]</div>
<p>where the function <span class="math notranslate nohighlight">\(\psi(\theta)\)</span> can be any distribution as long as it is normalized. Ideally, we want the proposal distribution, i.e., the posterior <span class="math notranslate nohighlight">\(p(\theta \mid y)\)</span>, <strong>to not only wholly encapsulate <span class="math notranslate nohighlight">\(\psi(\theta)\)</span>, but to match the distribution of the posterior as closely as possible</strong>. The optimal distribution for <span class="math notranslate nohighlight">\(\psi(\theta)\)</span>, is of course the posterior distribution itself!</p>
<p>The insight from <a class="reference external" href="https://arxiv.org/abs/2111.12720">McEwen et al. 2021</a> and <a class="reference external" href="https://arxiv.org/abs/2405.05969">Polanska et al. 2024</a> is that the optimal <span class="math notranslate nohighlight">\(\psi(\theta)\)</span> can be learnt using normalizing flows. In other words, we have:</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}_{p(\theta \mid y)}\left[ \frac{\psi(\theta)}{\mathcal{L}(\theta)} \right]
= \left( \frac{1}{N} \sum_{i=1}^N \frac{\psi(\theta_i)}{\mathcal{L}(\theta_i)} \right),
\]</div>
<p>where <span class="math notranslate nohighlight">\(\psi(\theta)\)</span> is trained to mimic the posterior distribution.</p>
<p>The library <a class="reference external" href="https://astro-informatics.github.io/harmonic/index.html"><code class="docutils literal notranslate"><span class="pre">harmonic</span></code></a> implements this utility. Let’s run the LHME over the one-component SED scenario to get its evidence estimate, first by training a normalizing flow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">harmonic</span> <span class="k">as</span> <span class="nn">hm</span>

<span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">lnprob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">get_log_prob</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

<span class="n">chains</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Chains</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_vals</span><span class="p">))</span>
<span class="n">chains</span><span class="o">.</span><span class="n">add_chains_3d</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">lnprob</span><span class="p">)</span>
<span class="n">chains_train</span><span class="p">,</span> <span class="n">chains_infer</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">training_proportion</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-04-30 09:32:42.354456: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer.so.7&#39;; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory
2025-04-30 09:32:42.354524: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library &#39;libnvinfer_plugin.so.7&#39;; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory
2025-04-30 09:32:42.354532: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">RQSplineModel</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_vals</span><span class="p">),</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">epochs_num</span> <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># Train normalizing flow model</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chains_train</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs_num</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training NF: 100%|██████████████████████████████| 20/20 [02:01&lt;00:00,  6.06s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_vals</span><span class="p">)))</span>
<span class="n">samp_num</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flow_samples</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samp_num</span><span class="p">)</span>
<span class="n">hm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_getdist_compare</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">flow_samples</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/fbdf51cd1aa8faafe4ccfafa70ea26b4cf0334e3b7ee7dccc55068ff10a6fde8.png" src="../_images/fbdf51cd1aa8faafe4ccfafa70ea26b4cf0334e3b7ee7dccc55068ff10a6fde8.png" />
</div>
</div>
<p>Recall that the goal is to maximize the coverage of the posterior distribution <strong>over</strong> the concentrated flow. Next, we estimate the log evidence for the one-component SED scenario:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate harmonic&#39;s evidence class</span>
<span class="n">ev</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">chains_infer</span><span class="o">.</span><span class="n">nchains</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="c1"># Pass the evidence class the inference chains and compute the evidence!</span>
<span class="n">ev</span><span class="o">.</span><span class="n">add_chains</span><span class="p">(</span><span class="n">chains_infer</span><span class="p">)</span>
<span class="n">ln_inv_evidence_one_sed</span>  <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">ln_evidence_inv</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;One-component SED fit Log Evidence: </span><span class="si">{</span><span class="o">-</span><span class="n">ln_inv_evidence_one_sed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>One-component SED fit Log Evidence: 451.1123046875
</pre></div>
</div>
</div>
</div>
<p>Now let’s do the same for the two-component SED model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sampler_twocomp</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">lnprob_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sampler_twocomp</span><span class="o">.</span><span class="n">get_log_prob</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>

<span class="n">chains_two</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Chains</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_vals_twomodel</span><span class="p">))</span>
<span class="n">chains_two</span><span class="o">.</span><span class="n">add_chains_3d</span><span class="p">(</span><span class="n">samples_two</span><span class="p">,</span> <span class="n">lnprob_two</span><span class="p">)</span>
<span class="n">chains_two_train</span><span class="p">,</span> <span class="n">chains_two_infer</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">chains_two</span><span class="p">,</span> <span class="n">training_proportion</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_two</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">RQSplineModel</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">init_vals_twomodel</span><span class="p">),</span> <span class="n">standardize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">epochs_num</span> <span class="o">=</span> <span class="mi">20</span>
<span class="c1"># Train normalizing flow model</span>
<span class="n">model_two</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chains_two_train</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs_num</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training NF: 100%|██████████████████████████████| 20/20 [02:04&lt;00:00,  6.21s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples_two</span> <span class="o">=</span> <span class="n">samples_two</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_vals_twomodel</span><span class="p">)))</span>
<span class="n">flow_samples_two</span> <span class="o">=</span> <span class="n">model_two</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">samples_two</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">hm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">plot_getdist_compare</span><span class="p">(</span><span class="n">samples_two</span><span class="p">,</span> <span class="n">flow_samples_two</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/c73854c4cb134d822058a86229b07e7f4dfb65ab19888993478df01768c8098d.png" src="../_images/c73854c4cb134d822058a86229b07e7f4dfb65ab19888993478df01768c8098d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiate harmonic&#39;s evidence class</span>
<span class="n">ev_two</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">chains_two_infer</span><span class="o">.</span><span class="n">nchains</span><span class="p">,</span> <span class="n">model_two</span><span class="p">)</span>
<span class="c1"># Pass the evidence class the inference chains and compute the evidence!</span>
<span class="n">ev_two</span><span class="o">.</span><span class="n">add_chains</span><span class="p">(</span><span class="n">chains_two_infer</span><span class="p">)</span>
<span class="n">ln_inv_evidence_two_sed</span>  <span class="o">=</span> <span class="n">ev_two</span><span class="o">.</span><span class="n">ln_evidence_inv</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Two-component SED fit Log Evidence: </span><span class="si">{</span><span class="o">-</span><span class="n">ln_inv_evidence_two_sed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Two-component SED fit Log Evidence: 461.00140380859375
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bayes_factor_ln</span> <span class="o">=</span> <span class="o">-</span><span class="n">ln_inv_evidence_two_sed</span> <span class="o">-</span> <span class="o">-</span><span class="n">ln_inv_evidence_one_sed</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bayes Factor (Two-to-One Component): </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bayes_factor_ln</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bayes Factor (Two-to-One Component): 19714.291
</pre></div>
</div>
</div>
</div>
<p>The following <strong>Jeffreys’ Scale</strong> quantify how much more likely the data are under Model 2 (<span class="math notranslate nohighlight">\(M_2\)</span>) compared to Model 1 (<span class="math notranslate nohighlight">\(M_1\)</span>) using the Bayes factor <span class="math notranslate nohighlight">\( p(y \mid M_2) / p(y \mid M_1) \)</span>. The table below provides qualitative interpretation thresholds based on the <strong>magnitude</strong> of the Bayes factor.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Bayes Factor</p></th>
<th class="head"><p>Strength of Evidence for <span class="math notranslate nohighlight">\( M_2 \)</span> over <span class="math notranslate nohighlight">\( M_1 \)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\( &lt; 1 \)</span></p></td>
<td><p>Evidence favors <span class="math notranslate nohighlight">\( M_1 \)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\( 1 \)</span> to <span class="math notranslate nohighlight">\( 3 \)</span></p></td>
<td><p>Barely worth mentioning</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\( 3 \)</span> to <span class="math notranslate nohighlight">\( 10 \)</span></p></td>
<td><p>Substantial evidence</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\( 10 \)</span> to <span class="math notranslate nohighlight">\( 30 \)</span></p></td>
<td><p>Strong evidence</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\( 30 \)</span> to <span class="math notranslate nohighlight">\( 100 \)</span></p></td>
<td><p>Very strong evidence</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\( &gt; 100 \)</span></p></td>
<td><p>Decisive evidence</p></td>
</tr>
</tbody>
</table>
<p>We thus see that the two-component SED is strongly favoured over the one-component SED in this scenario.</p>
<div class="admonition-exercise admonition">
<p class="admonition-title">Exercise</p>
<ol class="arabic simple">
<li><p>How does the evidence calculated using the Learned Mean Harmonic Estimator compare with the original Mean Harmonic Estimator, calculated as</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">likelihoods</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">likelihood_fn</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="k">for</span> <span class="n">theta</span> <span class="ow">in</span> <span class="n">posterior_samples</span><span class="p">])</span>
<span class="n">evidence_estimate</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">likelihoods</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>The example below is a specific case of a white dwarf that appears to have an excess in the infrared. Fit a single white dwarf SED model (using Koester models), calculate the evidence, and then determine if a white dwarf + brown dwarf two-component SED (using CK09) is better justified.</p></li>
</ol>
<p>The <code class="docutils literal notranslate"><span class="pre">flux_uncertainty_inflation</span></code> variable below artificially inflates the uncertainty of the flux measurements. How does the Bayes factor between the two fits change when you modify this variable? Why?</p>
<ol class="arabic simple" start="3">
<li><p>Go back to the example in <a class="reference internal" href="sed-2.html#content-references-sed-part2"><span class="std std-ref">Spectral Energy Distribution (SED) Part 2: Fitting SEDs</span></a> and determine if there is evidence for two sources in the SED using the Learned Harmonic Mean Estimator.</p></li>
</ol>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">,</span> <span class="s1">&#39;phot_data&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;/wd-bd.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;distance_pc&quot;</span><span class="p">]</span> <span class="c1"># Distance in parsec</span>

<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;band&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span> <span class="c1"># Extract band-wise values</span>
<span class="n">mags</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>
<span class="n">magerrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag_err&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Star ID: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;starname&quot;</span><span class="p">])</span> <span class="c1"># Star name </span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span> <span class="c1"># print band name and apparent magnitude and error</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Star ID:  GD 1400
16.4044 0.0239 GALEX_FUV
15.6508 0.0103 GALEX_NUV
14.923 0.032 2MASS_J
14.45 0.045 2MASS_H
14.335 0.064 2MASS_Ks
15.210746 0.02 Gaia_G
15.231833 0.02 Gaia_BP
15.178323 0.02 Gaia_RP
13.789 0.028 WISE_RSR_W1
13.623 0.039 WISE_RSR_W2
12.838 0.531 WISE_RSR_W3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flux_uncertainty_inflation</span> <span class="o">=</span> <span class="mf">0.2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="n">n_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n_bands</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">band_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">merr</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
    <span class="n">f_</span><span class="p">,</span> <span class="n">f_err</span> <span class="o">=</span> <span class="n">mag_to_flux</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">mag_err</span> <span class="o">=</span> <span class="n">merr</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">f_err</span> <span class="o">+=</span> <span class="n">flux_uncertainty_inflation</span><span class="o">*</span><span class="n">f_</span>   <span class="c1"># Note: Inflating uncertainty</span>
    <span class="n">w_</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">band_colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">f_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">obs_flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_</span><span class="p">);</span> <span class="n">obs_flux_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_err</span><span class="p">);</span> <span class="n">obs_wav</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w_</span><span class="p">)</span>
    
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> 
                                                                             <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">240000</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">14500</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">);</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">bb</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="n">wav</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="o">*</span><span class="mf">0.003</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">dist</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">)),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.735</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="s1">&#39;Flux Excess?&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">obs_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_flux_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux_err</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bands</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_30688/3494858413.py:4: MatplotlibDeprecationWarning: The get_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps[name]`` or ``matplotlib.colormaps.get_cmap(obj)`` instead.
  cmap = cm.get_cmap(&#39;Spectral_r&#39;)
</pre></div>
</div>
<img alt="../_images/1755def0eb1b3d6a9dfdaac90109dbe8c19b086d6543d823bcaaa5a1dceaaf06.png" src="../_images/1755def0eb1b3d6a9dfdaac90109dbe8c19b086d6543d823bcaaa5a1dceaaf06.png" />
</div>
</div>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://github.com/cwestend/iNNterpol/tree/main">iNNterpol: High-precision interpolation of stellar atmospheres with a deep neural network using a 1D convolutional auto encoder for feature extraction</a></p>
<p>Prediction and interpolation of model atmospheres using convolutional autoencoders</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sed-2.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Spectral Energy Distribution (SED) Part 2: <em>Fitting SEDs</em></p>
      </div>
    </a>
    <a class="right-next"
       href="spectra-1.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Stellar Spectra Part 1: <em>Observing Detailed Spectral Features</em></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#excess-flux-in-seds">Excess flux in SEDs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-component-sed-fitting">Two-component SED fitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-model-evidence-from-bayes-theorem">Bayesian Model Evidence from Bayes’ Theorem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definition-of-evidence">Definition of Evidence</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evidence-in-model-comparison">Evidence in Model Comparison</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-harmonic-mean-estimator-hme">The Harmonic Mean Estimator (HME)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-learned-harmonic-mean-estimator-lhme">The Learned Harmonic Mean Estimator (LHME)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See also</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Marc Hon
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>