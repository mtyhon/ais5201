

<!DOCTYPE html>


<html data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spectral Energy Distribution (SED) Part 2: Fitting SEDs &#8212; AI for Astronomy Textbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter2/sed-2-Copy1';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="AI for Astronomy Textbook - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="AI for Astronomy Textbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter1/section_intro.html">Time-domain Data</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_1.html">Fitting the Global Properties of Red Giant Oscillations Part 1: Traditional Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_2.html">Fitting the Global Properties of Red Giant Oscillations Part 2: Flows &amp; Simulation-Based Inference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/ps_statistics.html">Power Spectrum Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_1.html">Eclipse Morphology Part 1: Exploring and Preparing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_2.html">Eclipse Morphology Part 2: Low-Dimensional Representations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_3.html">Eclipse Morphology Part 3: Latent Spaces and Visualizing Them</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_4.html">Eclipse Morphology Part 4: The Variational Autoencoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-1.html">Planetary Transits Part 1: Observing Transits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-2.html">Planetary Transits Part 2: Classifying Transits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-3.html">Planetary Transits Part 3: Fitting a Transit Profile</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="section_intro.html">Spectra</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="sed-1.html">Spectral Energy Distribution (SED) Part 1: Observing SEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="sed-2.html">Spectral Energy Distribution (SED) Part 2: Fitting SEDs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapter3/markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter4/mymarkdown.html">Hereâ€™s my sample title</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter2/sed-2-Copy1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter2/sed-2-Copy1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Spectral Energy Distribution (SED) Part 2: Fitting SEDs</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apparent-magnitudes-and-observed-flux">Apparent magnitudes and observed flux</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-apparent-magnitude-measurements">Retrieving apparent magnitude measurements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-the-observed-photometry-to-synthetic-photometry">Fitting the observed photometry to synthetic photometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grid-parameters">Grid parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-factors">Additional factors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc-sed-fitting">MCMC SED Fitting</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="spectral-energy-distribution-sed-part-2-fitting-seds">
<span id="content-references-sed-part2"></span><h1>Spectral Energy Distribution (SED) Part 2: Fitting SEDs<a class="headerlink" href="#spectral-energy-distribution-sed-part-2-fitting-seds" title="Permalink to this headline">#</a></h1>
<p><em><strong>Author: Marc Hon</strong></em></p>
<p>In this chapter, we will be fitting the Spectral Energy Distribution (SED) of a star based on the synthetic photometry created from model atmospheres of stars as discussed in the previous Section.</p>
<section id="apparent-magnitudes-and-observed-flux">
<h2>Apparent magnitudes and observed flux<a class="headerlink" href="#apparent-magnitudes-and-observed-flux" title="Permalink to this headline">#</a></h2>
<p>If you are to look up information of a star, for example in <a class="reference external" href="https://simbad.u-strasbg.fr/simbad/">SIMBAD</a>, you will frequently see the following flux information about a source:</p>
<figure class="align-default" id="simbad">
<a class="reference internal image-reference" href="../_images/simbad.png"><img alt="../_images/simbad.png" src="../_images/simbad.png" style="width: 850px; height: 350px;" /></a>
<figcaption>
<p><span class="caption-text">An example of a starâ€™s information on SIMBAD, with flux data highlighted.</span><a class="headerlink" href="#simbad" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Whatâ€™s being reported here are not direct flux measurements as weâ€™ve previously seen, but apparent magnitudes across different bandpasses.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Apparent magnitudes are a logarithmic measure of how bright a star or object appears in the sky as seen from Earth. They are much more convenient for reporting the brightness of objects as opposed to quoting flux values that span orders of magnitude!</p>
<p>By definition, a difference of 1 magnitude corresponds to a brightness ratio of approximately 2.512, meaning an object that is 1 magnitude fainter appears about 2.5 times dimmer.</p>
</div>
<p>To meaningfully compare observed photometry with synthetic SEDs, it is necessary to convert magnitudes into physical flux units. This depends on whether or not the filter uses the <strong>Vega</strong> or the <strong>AB</strong> magnitude system.</p>
<ul class="simple">
<li><p><strong>Vega</strong>: The magnitudes are calibrated so that the star Vega has magnitude zero in all bands. Therefore, you need to know the zero-point flux, <span class="math notranslate nohighlight">\(F_{\lambda, 0}\)</span> ,associated for that specific photometric system. For a given apparent magnitude, the flux is <span class="math notranslate nohighlight">\(F_{\lambda} = F_{\lambda, 0} \times 10^{-0.4m}\)</span>.</p></li>
<li><p><strong>AB</strong>: Calibrated in absolute units, so does not use a reference star. Defined such that a source with <span class="math notranslate nohighlight">\(F_{\lambda}\)</span> = <span class="math notranslate nohighlight">\(3.63\times10^{-20}\)</span> erg cm<span class="math notranslate nohighlight">\(^{-2}\)</span> s<span class="math notranslate nohighlight">\(^{-1}\)</span> Hz<span class="math notranslate nohighlight">\(^{-1}\)</span> has an AB magnitude of 0 in every filter, and in general the apparent magnitudes are <span class="math notranslate nohighlight">\(m_{\mathrm{AB}}\)</span> = -2.5 <span class="math notranslate nohighlight">\(\log F_{\mathrm{\lambda}} - 48.6\)</span>.</p></li>
</ul>
<p>The functions below encapsulate these conversions, using the <code class="docutils literal notranslate"><span class="pre">astropy</span></code> library to help with the physical constants and units. We will use the <code class="docutils literal notranslate"><span class="pre">pyphot</span></code> library, which provides a very helpful <a class="reference external" href="https://mfouesneau.github.io/pyphot/libcontent.html">library of filters</a> with information about their wavelengths and zero-point fluxes.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">pyphot</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">astropy.constants</span> <span class="k">as</span> <span class="nn">const</span>
<span class="kn">import</span> <span class="nn">pysynphot</span> <span class="k">as</span> <span class="nn">S</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">astropy.modeling.models</span> <span class="kn">import</span> <span class="n">BlackBody</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">coordinates</span> <span class="k">as</span> <span class="n">coords</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">truncnorm</span><span class="p">,</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">log</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>


<span class="n">data_folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;ml_astro&#39;</span> <span class="o">/</span> <span class="s1">&#39;chapter2&#39;</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PYSYN_CDBS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;science&#39;</span><span class="p">)</span>

<span class="n">fs</span> <span class="o">=</span> <span class="mi">18</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mag_to_flux_AB</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculate flux in erg s-1 cm-2 Hz-1.&quot;&quot;&quot;</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="p">(</span><span class="n">mag</span> <span class="o">+</span> <span class="mf">48.6</span><span class="p">))</span>
    <span class="n">flux_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag_err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span>


<span class="k">def</span> <span class="nf">get_zero_flux</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Look for the filter information in the pyphot library of filters.&quot;&quot;&quot;</span>
    <span class="c1"># Load photometry filter library</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">pyphot</span><span class="o">.</span><span class="n">get_library</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>
    <span class="c1"># Get Vega zero flux in erg / cm2 / s / AA</span>
    <span class="n">f0</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">Vega_zero_flux</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;erg/(AA * cm ** 2 * s)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">return</span> <span class="n">f0</span>


<span class="k">def</span> <span class="nf">get_effective_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get central wavelength of a specific filter in um.&quot;&quot;&quot;</span>
    <span class="c1"># Load photometry filter library</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">pyphot</span><span class="o">.</span><span class="n">get_library</span><span class="p">()[</span><span class="n">band</span><span class="p">]</span>
    <span class="c1"># Get central wavelength in um</span>
    <span class="n">leff</span> <span class="o">=</span> <span class="n">filt</span><span class="o">.</span><span class="n">cl</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">magnitude</span>
    <span class="k">return</span> <span class="n">leff</span>

<span class="k">def</span> <span class="nf">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert flux from erf s-1 cm-2 Hz-1 to erg s-1 cm-2 lambda-1.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">f</span> <span class="o">*</span> <span class="n">const</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span> <span class="o">/</span> <span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="n">l</span> <span class="o">**</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">mag_to_flux</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert from magnitude to flux.</span>

<span class="sd">    mag_to_flux performs the conversion from magnitude to flux in</span>
<span class="sd">    erg s-1 cm-2 AA-1.5</span>

<span class="sd">    The band parameter is a string representing the filter used and it must</span>
<span class="sd">    match exactly the name in pyphots filter database</span>

<span class="sd">    If the filter is from PanSTARRS or SDSS, then the magnitude is in the AB</span>
<span class="sd">    system. Else it&#39;s in the Vega system.</span>
<span class="sd">    </span>
<span class="sd">    Borrowed from https://github.com/jvines/astroARIADNE</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;PS1_&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s1">&#39;SDSS_&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s1">&#39;GALEX_&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="c1"># Get flux from AB mag</span>
        <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span> <span class="o">=</span> <span class="n">mag_to_flux_AB</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">mag_err</span><span class="p">)</span>
        <span class="c1"># Get effective wavelength for bandpass</span>
        <span class="n">leff</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
        <span class="c1"># Convert from f_nu to f_lambda in erg / cm2 / s / AA</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">leff</span><span class="p">)</span>
        <span class="n">flux_err</span> <span class="o">=</span> <span class="n">convert_f_nu_to_f_lambda</span><span class="p">(</span><span class="n">flux_err</span><span class="p">,</span> <span class="n">leff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get flux in erg / cm2 / s / AA</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">get_zero_flux</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">mag</span><span class="p">)</span> <span class="o">*</span> <span class="n">f0</span>
        <span class="n">flux_err</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="mf">.4</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">mag_err</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">pyphot</span></code> returns fluxes in <span class="math notranslate nohighlight">\(F_\nu\)</span> (flux per unit frequency), while we seek <span class="math notranslate nohighlight">\(F_\lambda\)</span>, the flux per unit wavelength, since we will be plotting SEDs over wavelength. The conversion is</p>
<div class="math notranslate nohighlight">
\[
F_\nu =  \frac{c}{\lambda^2}{F_\lambda},
\]</div>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is the speed of light. It is for this purpose that the effective wavelength <span class="math notranslate nohighlight">\(\lambda\)</span> of each band was required to be determined in the code above.</p>
</div>
</section>
<section id="retrieving-apparent-magnitude-measurements">
<h2>Retrieving apparent magnitude measurements<a class="headerlink" href="#retrieving-apparent-magnitude-measurements" title="Permalink to this headline">#</a></h2>
<p>There are a variety of ways to retrieve apparent magnitude measurements for sources. The <a class="reference external" href="https://simbad.u-strasbg.fr/simbad/">SIMBAD</a> portal often provides flux information from several common bandpasses (e.g., Johnson UBV, <em>Gaia</em> G band), but may mass out on measurements from more obscure surveys that are equally useful. Alternatives to comprehensively get a list of photometry are:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://svo2.cab.inta-csic.es/theory/vosa/">Virtual Observatory SED Analyzer (VOSA)</a>: VOSA provides a convenient online interface to first query sky coordinate for a source, and then perform an exhaustive search over databases for available photometry.</p></li>
<li><p>The <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/index.html"><code class="docutils literal notranslate"><span class="pre">astroquery</span></code></a> library has tools to programmaticaly query astronomical web forms and databases. For examples on how to do this, see <a class="reference external" href="https://github.com/jvines/astroARIADNE/blob/master/astroARIADNE/librarian.py">this link</a>.</p></li>
</ul>
<p>For this exercise, several examples have conveniently been compiled and included alongside this notebook. Letâ€™s load an example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">,</span> <span class="s1">&#39;phot_data&#39;</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;/ms.yaml&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;distance_pc&quot;</span><span class="p">]</span> <span class="c1"># Distance in parsec</span>

<span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;band&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span> <span class="c1"># Extract band-wise values</span>
<span class="n">mags</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>
<span class="n">magerrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;mag_err&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;photometry&quot;</span><span class="p">]]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Star ID: &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;starname&quot;</span><span class="p">])</span> <span class="c1"># Star name </span>
<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span> <span class="c1"># print band name and apparent magnitude and error</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Star ID:  55 Cnc
19.9648113 0.1062631 GALEX_FUV
13.2163258 0.00294659636 GALEX_NUV
4.59 0.05 2MASS_J
4.14 0.05 2MASS_H
4.015 0.036 2MASS_Ks
5.732681 0.02 Gaia_G
6.155681 0.02 Gaia_BP
5.1470094 0.02 Gaia_RP
7.037 0.015 TYCHO_B_MvB
6.036 0.01 TYCHO_V_MvB
4.001 0.318 WISE_RSR_W1
3.296 0.174 WISE_RSR_W2
4.051 0.015 WISE_RSR_W3
4.014 0.03 WISE_RSR_W4
</pre></div>
</div>
</div>
</div>
<p>For each band, we will convert magnitudes to flux using <code class="docutils literal notranslate"><span class="pre">mag_to_flux(mag,</span> <span class="pre">mag_err,</span> <span class="pre">band)</span></code>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="n">n_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">)</span>
<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n_bands</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">band_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">band</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bands</span><span class="p">,</span> <span class="n">color_list</span><span class="p">)}</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">merr</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mags</span><span class="p">,</span> <span class="n">magerrs</span><span class="p">,</span> <span class="n">bands</span><span class="p">):</span>
    <span class="n">f_</span><span class="p">,</span> <span class="n">f_err</span> <span class="o">=</span> <span class="n">mag_to_flux</span><span class="p">(</span><span class="n">mag</span><span class="o">=</span> <span class="n">m</span><span class="p">,</span> <span class="n">mag_err</span> <span class="o">=</span> <span class="n">merr</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">f_err</span> <span class="o">+=</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">f_</span>   <span class="c1"># Note: Inflating uncertainty</span>
    <span class="n">w_</span> <span class="o">=</span> <span class="n">get_effective_wavelength</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">band_colors</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">f_</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">f_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">obs_flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_</span><span class="p">);</span> <span class="n">obs_flux_err</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_err</span><span class="p">);</span> <span class="n">obs_wav</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w_</span><span class="p">)</span>
    
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(</span><span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="n">obs_flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_flux_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">obs_flux_err</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bands</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)]</span>
<span class="n">obs_wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">obs_wav</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_729851/3359577824.py:4: MatplotlibDeprecationWarning: The get_cmap function was deprecated in Matplotlib 3.7 and will be removed two minor releases later. Use ``matplotlib.colormaps[name]`` or ``matplotlib.colormaps.get_cmap(obj)`` instead.
  cmap = cm.get_cmap(&#39;Spectral_r&#39;)
/tmp/ipykernel_729851/3359577824.py:15: UserWarning: *c* argument looks like a single numeric RGB or RGBA sequence, which should be avoided as value-mapping will have precedence in case its length matches with *x* &amp; *y*.  Please use the *color* keyword-argument or provide a 2D array with a single row if you intend to specify the same RGB or RGBA value for all points.
  ax1.scatter(w_, f_, label=b, c=band_colors[b])
</pre></div>
</div>
<img alt="../_images/d19b2da0f8ed489cd23820d7bb52cd89fc6383aa83129f1449d18397c239e087.png" src="../_images/d19b2da0f8ed489cd23820d7bb52cd89fc6383aa83129f1449d18397c239e087.png" />
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For brevity, horizontal errorbars corresponding to the effective width of each passband are not shown above. We also assume more realistic errors by infating the flux uncertainties to be 20% of the observed flux value.</p>
</div>
<p>Now that we have converted observed magnitudes to flux values, we want to compare them with values from models to learn something about the star that we are observing. We will use Markov Chain Monte Carlo (MCMC) to fit synthetic photometry to the observed data and assess how much information that SEDs can provide on stellar parameters.</p>
</section>
<section id="fitting-the-observed-photometry-to-synthetic-photometry">
<h2>Fitting the observed photometry to synthetic photometry<a class="headerlink" href="#fitting-the-observed-photometry-to-synthetic-photometry" title="Permalink to this headline">#</a></h2>
<p>We will use the synthetic photometry from the <a class="reference external" href="https://www.stsci.edu/hst/instrumentation/reference-data-for-calibration-and-tools/astronomical-catalogs/castelli-and-kurucz-atlas">Castelli and Kurucz 2004</a> models, another well-known library of stellar atmospheres.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">phot_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/CK09.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;met&#39;</span><span class="p">,</span> <span class="s1">&#39;teff&#39;</span><span class="p">,</span> <span class="s1">&#39;logg&#39;</span><span class="p">])</span>
<span class="n">phot_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>2MASS_J</th>
      <th>2MASS_H</th>
      <th>2MASS_Ks</th>
      <th>GALEX_NUV</th>
      <th>GALEX_FUV</th>
      <th>SDSS_u</th>
      <th>SDSS_g</th>
      <th>SDSS_r</th>
      <th>SDSS_i</th>
      <th>SDSS_z</th>
      <th>Gaia_G</th>
      <th>Gaia_BP</th>
      <th>Gaia_RP</th>
      <th>TYCHO_B_MvB</th>
      <th>TYCHO_V_MvB</th>
      <th>WISE_RSR_W1</th>
      <th>WISE_RSR_W2</th>
      <th>WISE_RSR_W3</th>
      <th>WISE_RSR_W4</th>
    </tr>
    <tr>
      <th>met</th>
      <th>teff</th>
      <th>logg</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">-2.5</th>
      <th rowspan="5" valign="top">3500</th>
      <th>0.0</th>
      <td>4.996000e+05</td>
      <td>4.619353e+05</td>
      <td>2.021088e+05</td>
      <td>4.232484e+00</td>
      <td>3.635546e-07</td>
      <td>3.983628e+03</td>
      <td>8.149538e+04</td>
      <td>3.169087e+05</td>
      <td>4.841759e+05</td>
      <td>5.470721e+05</td>
      <td>3.550839e+05</td>
      <td>1.790237e+05</td>
      <td>4.930941e+05</td>
      <td>2.700492e+04</td>
      <td>1.636760e+05</td>
      <td>38565.453905</td>
      <td>11875.536258</td>
      <td>466.821193</td>
      <td>36.058769</td>
    </tr>
    <tr>
      <th>0.5</th>
      <td>5.014510e+05</td>
      <td>4.448222e+05</td>
      <td>1.909531e+05</td>
      <td>7.064660e+00</td>
      <td>4.239363e-07</td>
      <td>6.553515e+03</td>
      <td>1.142456e+05</td>
      <td>3.792471e+05</td>
      <td>5.300132e+05</td>
      <td>5.725593e+05</td>
      <td>3.998374e+05</td>
      <td>2.248705e+05</td>
      <td>5.332171e+05</td>
      <td>4.130109e+04</td>
      <td>2.138359e+05</td>
      <td>35325.190442</td>
      <td>11524.888372</td>
      <td>444.199037</td>
      <td>35.031477</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>5.052427e+05</td>
      <td>4.229727e+05</td>
      <td>1.784930e+05</td>
      <td>1.225059e+01</td>
      <td>3.660543e-07</td>
      <td>1.102999e+04</td>
      <td>1.539556e+05</td>
      <td>4.402068e+05</td>
      <td>5.736100e+05</td>
      <td>5.991485e+05</td>
      <td>4.450978e+05</td>
      <td>2.738156e+05</td>
      <td>5.722846e+05</td>
      <td>6.181669e+04</td>
      <td>2.683026e+05</td>
      <td>32464.733312</td>
      <td>11153.477986</td>
      <td>424.929981</td>
      <td>34.081057</td>
    </tr>
    <tr>
      <th>1.5</th>
      <td>5.055122e+05</td>
      <td>3.959714e+05</td>
      <td>1.667831e+05</td>
      <td>2.385142e+01</td>
      <td>4.840257e-07</td>
      <td>1.795447e+04</td>
      <td>1.912682e+05</td>
      <td>4.883810e+05</td>
      <td>6.102816e+05</td>
      <td>6.239768e+05</td>
      <td>4.834401e+05</td>
      <td>3.154342e+05</td>
      <td>6.057273e+05</td>
      <td>8.527702e+04</td>
      <td>3.140412e+05</td>
      <td>30814.045451</td>
      <td>10922.323896</td>
      <td>416.145986</td>
      <td>33.644490</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>5.020867e+05</td>
      <td>3.639484e+05</td>
      <td>1.575972e+05</td>
      <td>5.808576e+01</td>
      <td>1.770867e-06</td>
      <td>2.564215e+04</td>
      <td>2.147626e+05</td>
      <td>5.153433e+05</td>
      <td>6.338933e+05</td>
      <td>6.414389e+05</td>
      <td>5.070017e+05</td>
      <td>3.398975e+05</td>
      <td>6.274480e+05</td>
      <td>1.039133e+05</td>
      <td>3.396386e+05</td>
      <td>31089.811135</td>
      <td>11066.810861</td>
      <td>426.822245</td>
      <td>34.423630</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">0.5</th>
      <th rowspan="2" valign="top">48000</th>
      <th>4.5</th>
      <td>3.918678e+07</td>
      <td>1.261939e+07</td>
      <td>4.280296e+06</td>
      <td>2.158392e+10</td>
      <td>7.088278e+10</td>
      <td>4.451326e+09</td>
      <td>1.674874e+09</td>
      <td>5.794493e+08</td>
      <td>2.788151e+08</td>
      <td>1.376949e+08</td>
      <td>6.792595e+08</td>
      <td>1.302458e+09</td>
      <td>2.508396e+08</td>
      <td>2.547880e+09</td>
      <td>1.075223e+09</td>
      <td>744774.296522</td>
      <td>208175.994061</td>
      <td>6978.220106</td>
      <td>470.182482</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>3.884345e+07</td>
      <td>1.250314e+07</td>
      <td>4.238751e+06</td>
      <td>2.180255e+10</td>
      <td>7.423922e+10</td>
      <td>4.429914e+09</td>
      <td>1.672514e+09</td>
      <td>5.750950e+08</td>
      <td>2.770473e+08</td>
      <td>1.361824e+08</td>
      <td>6.764076e+08</td>
      <td>1.298043e+09</td>
      <td>2.490120e+08</td>
      <td>2.537994e+09</td>
      <td>1.072513e+09</td>
      <td>737543.271441</td>
      <td>206182.686810</td>
      <td>6913.069103</td>
      <td>466.074540</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">49000</th>
      <th>4.5</th>
      <td>4.000997e+07</td>
      <td>1.287895e+07</td>
      <td>4.366115e+06</td>
      <td>2.225678e+10</td>
      <td>7.337195e+10</td>
      <td>4.572393e+09</td>
      <td>1.715348e+09</td>
      <td>5.930302e+08</td>
      <td>2.850657e+08</td>
      <td>1.407661e+08</td>
      <td>6.954815e+08</td>
      <td>1.334328e+09</td>
      <td>2.564976e+08</td>
      <td>2.612272e+09</td>
      <td>1.100473e+09</td>
      <td>759377.490552</td>
      <td>212212.310946</td>
      <td>7110.422154</td>
      <td>479.002304</td>
    </tr>
    <tr>
      <th>5.0</th>
      <td>3.965761e+07</td>
      <td>1.276020e+07</td>
      <td>4.324204e+06</td>
      <td>2.248706e+10</td>
      <td>7.694703e+10</td>
      <td>4.550026e+09</td>
      <td>1.712902e+09</td>
      <td>5.883748e+08</td>
      <td>2.832170e+08</td>
      <td>1.391797e+08</td>
      <td>6.924638e+08</td>
      <td>1.329647e+09</td>
      <td>2.545770e+08</td>
      <td>2.601959e+09</td>
      <td>1.097600e+09</td>
      <td>752118.106079</td>
      <td>210202.688812</td>
      <td>7045.337732</td>
      <td>474.810234</td>
    </tr>
    <tr>
      <th>50000</th>
      <th>5.0</th>
      <td>4.046279e+07</td>
      <td>1.301469e+07</td>
      <td>4.408408e+06</td>
      <td>2.317231e+10</td>
      <td>7.962793e+10</td>
      <td>4.669705e+09</td>
      <td>1.753061e+09</td>
      <td>6.015906e+08</td>
      <td>2.893469e+08</td>
      <td>1.421599e+08</td>
      <td>7.084432e+08</td>
      <td>1.361113e+09</td>
      <td>2.601084e+08</td>
      <td>2.665823e+09</td>
      <td>1.122495e+09</td>
      <td>766480.182183</td>
      <td>214162.433193</td>
      <td>7174.778031</td>
      <td>483.373463</td>
    </tr>
  </tbody>
</table>
<p>3808 rows Ã— 19 columns</p>
</div></div></div>
</div>
<section id="grid-parameters">
<h3>Grid parameters<a class="headerlink" href="#grid-parameters" title="Permalink to this headline">#</a></h3>
<p>Grids of model SEDs are typically parameterized by the starâ€™s effective temperature (<span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>), surface gravity (<span class="math notranslate nohighlight">\(\log (g)\)</span>), and <em>met</em>allicity ([M/H]). These physical parameters determine the detailed shape and features of the stellar spectrum across different wavelengths as seen in the last Section.</p>
<p>Note that the combination of parameters ([Fe/H], <span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>, <span class="math notranslate nohighlight">\(\log (g)\)</span>) spanned by the synthetic photometry cover only <strong>discrete</strong> values. For MCMC, we want to sample a continuous parameter space.</p>
<p>To sample parameters of flux <strong>between</strong> grid points, we require some form of interpolation. For this exercise, we will rely on linear interpolation, implemented by the <code class="docutils literal notranslate"><span class="pre">DFInterpolator</span></code> class from the <code class="docutils literal notranslate"><span class="pre">isochrones</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">isochrones.interp</span> <span class="kn">import</span> <span class="n">DFInterpolator</span>

<span class="n">interpolator</span> <span class="o">=</span> <span class="n">DFInterpolator</span><span class="p">(</span><span class="n">phot_grid</span><span class="p">)</span>

<span class="c1"># The indexing goes as (met, teff, logg)</span>

<span class="c1">## Sanity Check ## !</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">## Making sure that interpolator gives the same value as points on the grid ## </span>
<span class="k">assert</span> <span class="n">phot_grid</span><span class="p">[</span><span class="n">phot_grid</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">idx</span><span class="p">]][</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span> <span class="o">==</span> <span class="n">interpolator</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span> <span class="c1"># index 2 is 2MASS_Ks</span>

<span class="c1">## Interpolator should give intermediate flux values in between grid values</span>
<span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">interpolator</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1"> is between </span><span class="si">{</span><span class="n">interpolator</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\</span>
<span class="s1">and </span><span class="si">{</span><span class="n">interpolator</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">])[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1"> for </span><span class="si">{</span><span class="n">phot_grid</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;340818.72368750104 is between 340593.70204344153 and 341171.7246860864 for 2MASS_Ks&#39;
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Do always perform basic checks on interpolators to ensure they are performing the expected approximations. Experiment with varying <code class="docutils literal notranslate"><span class="pre">idx</span></code> above to run the checks across different bands.</p>
<p>How well-suited is linear interpolation for this grid of SED models?</p>
</div>
</section>
<section id="additional-factors">
<h3>Additional factors<a class="headerlink" href="#additional-factors" title="Permalink to this headline">#</a></h3>
<p>When making the comparisons, two important factors must be accounted for: the scaling due to the starâ€™s size and distance, and the attenuation of light by interstellar dust along the line of sight. The <strong>dilution factor</strong> <span class="math notranslate nohighlight">\(D\)</span> describes how the intrinsic stellar flux is diminished due to distance and size, and is given by:</p>
<div class="math notranslate nohighlight">
\[
D = \left( \frac{R}{d} \right)^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(R\)</span> is the stellar radius and <span class="math notranslate nohighlight">\(d\)</span> is the distance to the star.</p>
<div class="tip admonition">
<p class="admonition-title">Squared scaling</p>
<p>How does the dilution factor assume its current scaling with length?</p>
</div>
<p>In addition to dilution, <strong>interstellar extinction</strong> must be applied to the model SEDs. Dust and gas between the star and observer absorb and scatter light, preferentially dimming shorter (bluer) wavelengths. This effect is commonly parameterized by a total extinction <span class="math notranslate nohighlight">\(A_V\)</span> or a monochromatic extinction <span class="math notranslate nohighlight">\(A_0\)</span>, and modifies the observed flux as:</p>
<div class="math notranslate nohighlight">
\[
F_{\mathrm{obs}}(\lambda) = F_{\mathrm{model}}(\lambda) \times 10^{-0.4 A(\lambda)},
\]</div>
<p>where <span class="math notranslate nohighlight">\(A(\lambda)\)</span> is the extinction curve as a function of wavelength. To apply this correction, we commonly use empirical extinction curves such the <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1999PASP..111...63F/abstract">Fitzpatrick (1999)</a> extinction law that applies across ultraviolet, optical, and infrared wavelengths. This curve is parameterized by the quantity <span class="math notranslate nohighlight">\(R_V\)</span>, defined as:</p>
<div class="math notranslate nohighlight">
\[
R_V = \frac{A_V}{E(B-V)},
\]</div>
<p>where <span class="math notranslate nohighlight">\(A_V\)</span> is the extinction in the V-band (visual), while <span class="math notranslate nohighlight">\(E(Bâˆ’V)\)</span> is the color excess, representing the amount of reddening between the B-band and V-band.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the diffuse interstellar medium in the Milky Way, a typical value is <span class="math notranslate nohighlight">\(R_V\)</span>=3.1. Higher values indicate dust with larger average grain sizes (less reddening per unit extinction), while lower values correspond to smaller grains and more severe reddening.</p>
</div>
<p>To see the effects of extinction in action, we will use the <code class="docutils literal notranslate"><span class="pre">extinction</span></code> package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">extinction</span>
<span class="kn">from</span> <span class="nn">extinction</span> <span class="kn">import</span> <span class="n">apply</span>

<span class="c1">## Black-Body ##</span>

<span class="n">wav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">40000</span><span class="p">)</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">AA</span>
<span class="n">bb</span> <span class="o">=</span> <span class="n">BlackBody</span><span class="p">(</span><span class="n">temperature</span><span class="o">=</span><span class="mi">5700</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">K</span><span class="p">);</span> <span class="n">flux</span> <span class="o">=</span> <span class="n">bb</span><span class="p">(</span><span class="n">wav</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">erg</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">AA</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">s</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">sr</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="o">/</span><span class="n">u</span><span class="o">.</span><span class="n">cm</span><span class="p">,</span> <span class="n">equivalencies</span><span class="o">=</span><span class="n">u</span><span class="o">.</span><span class="n">spectral_density</span><span class="p">(</span><span class="n">wav</span><span class="p">))</span><span class="o">.</span><span class="n">value</span>

<span class="c1">## Black-Body + Extinction ##</span>
<span class="n">Rv</span> <span class="o">=</span> <span class="mf">3.1</span>
<span class="n">Av</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">av_law</span> <span class="o">=</span> <span class="n">extinction</span><span class="o">.</span><span class="n">fitzpatrick99</span>
<span class="n">extinction_func</span> <span class="o">=</span> <span class="n">av_law</span><span class="p">(</span><span class="n">wav</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">Av</span><span class="p">,</span> <span class="n">Rv</span><span class="p">)</span>
<span class="n">extinction_flux</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">extinction_func</span><span class="p">,</span> <span class="n">flux</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">xlim_min</span><span class="p">,</span> <span class="n">xlim_max</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">40000</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;BlackBody at </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s1"> K&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">extinction_flux</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;BlackBody at </span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s1"> K + Extinction</span><span class="se">\n</span><span class="s1">($R_V$ = </span><span class="si">{</span><span class="n">Rv</span><span class="si">}</span><span class="s1">, $A_V$ = </span><span class="si">{</span><span class="n">Av</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength, $</span><span class="se">\\</span><span class="s1">lambda$ ($</span><span class="se">\\</span><span class="s1">AA$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Irradiance, $F_</span><span class="se">\\</span><span class="s1">lambda$ (erg cm$^{-2}$ s$^{-1}$ $</span><span class="se">\\</span><span class="s1">AA^{-1}$ sr$^{-1} </span><span class="se">\\</span><span class="s1">times 10^7$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim_min</span><span class="p">,</span> <span class="n">xlim_max</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">mticker</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_xminorticklabels</span><span class="p">():</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">label</span><span class="o">.</span><span class="n">set_ha</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/545e36e8490afc69e8e7c958a0b13cfea4557e87f6531a1c7cb2cabcd2229fe6.png" src="../_images/545e36e8490afc69e8e7c958a0b13cfea4557e87f6531a1c7cb2cabcd2229fe6.png" />
</div>
</div>
<p>Altogether, SED fitting may constrain the starâ€™s <strong>effective temperature, surface gravity, metallicity, radius, and line-of-sight extinction</strong>.</p>
</section>
</section>
<section id="mcmc-sed-fitting">
<h2>MCMC SED Fitting<a class="headerlink" href="#mcmc-sed-fitting" title="Permalink to this headline">#</a></h2>
<p>First we define some helper functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Dict to help align model grid bands with observed bands ##</span>

<span class="n">col_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">band</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">phot_grid</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>
<span class="n">col_to_idx</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;2MASS_J&#39;: 0,
 &#39;2MASS_H&#39;: 1,
 &#39;2MASS_Ks&#39;: 2,
 &#39;GALEX_NUV&#39;: 3,
 &#39;GALEX_FUV&#39;: 4,
 &#39;SDSS_u&#39;: 5,
 &#39;SDSS_g&#39;: 6,
 &#39;SDSS_r&#39;: 7,
 &#39;SDSS_i&#39;: 8,
 &#39;SDSS_z&#39;: 9,
 &#39;Gaia_G&#39;: 10,
 &#39;Gaia_BP&#39;: 11,
 &#39;Gaia_RP&#39;: 12,
 &#39;TYCHO_B_MvB&#39;: 13,
 &#39;TYCHO_V_MvB&#39;: 14,
 &#39;WISE_RSR_W1&#39;: 15,
 &#39;WISE_RSR_W2&#39;: 16,
 &#39;WISE_RSR_W3&#39;: 17,
 &#39;WISE_RSR_W4&#39;: 18}
</pre></div>
</div>
</div>
</div>
<p>We define our prior as a combination of uniform bounds and Gaussian-like priors on the stellar parameters:</p>
<ul class="simple">
<li><p>Metallicity ([Fe/H]) is constrained between âˆ’5 and +1, with a normal prior centered at âˆ’0.125 dex and a standard deviation of 0.234 dex.</p></li>
<li><p>Effective temperature (<span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>) is restricted to lie uniformly between 4000â€¯K and 6500â€¯K.</p></li>
<li><p>Radius (<span class="math notranslate nohighlight">\(R\)</span>) is limited uniformly between 0.1-1.5 (<span class="math notranslate nohighlight">\(R_{\mathrm{sol}}\)</span>).</p></li>
<li><p>Surface gravity <span class="math notranslate nohighlight">\(\log (g)\)</span> is given a truncated normal prior, centered at 4.0 with a standard deviation of 0.5 dex, truncated between 1 and 5 dex.</p></li>
<li><p>Distance (<span class="math notranslate nohighlight">\(d\)</span>) is assigned a truncated normal prior centered at the known distance to the star <code class="docutils literal notranslate"><span class="pre">dist</span></code>, with a small uncertainty of 1 pc and allowed to vary between 0 and 10,000 pc.</p></li>
<li><p>Extinction (<span class="math notranslate nohighlight">\(A_v\)</span>) is modeled with a truncated normal prior centered at 0, with a small dispersion of 0.1 mag, truncated to lie between 0 and <span class="math notranslate nohighlight">\(3\sigma\)</span> (i.e., up to 0.3 mag).</p></li>
</ul>
<p>Any parameter combination falling outside the uniform bounds is immediately assigned zero prior probability. Within the allowed regions, the likelihood is modified by the sum of the logarithms of the prior probability densities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">log_truncnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast log-probability of a truncated normal distribution.</span>
<span class="sd">    Equivalent to truncnorm.logpdf(x, a, b, loc=mu, scale=sigma)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Standardized bounds</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>

    <span class="c1"># CDF terms for normalization</span>
    <span class="n">cdf_a</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">cdf_b</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">erf</span><span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">cdf_b</span> <span class="o">-</span> <span class="n">cdf_a</span>

    <span class="c1"># Return -inf outside bounds</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">lower</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">upper</span> <span class="ow">or</span> <span class="n">norm</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1"># Log-pdf of truncated normal</span>
    <span class="n">logp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">norm</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logp</span>

<span class="k">def</span> <span class="nf">log_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fast log-probability of a normal distribution.</span>
<span class="sd">    Equivalent to norm.logpdf(x, a, b, loc=mu, scale=sigma)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Standardized bounds</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span>
    <span class="c1"># Log-pdf of truncated normal</span>
    <span class="n">logp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">log</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">logp</span>




<span class="c1">######################  MCMC PRIOR  ########################</span>

<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
    <span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">theta</span>
    <span class="n">mu_dist</span> <span class="o">=</span> <span class="n">dist_sunwd</span><span class="p">;</span> <span class="n">sigma_dist</span> <span class="o">=</span> <span class="mi">1</span><span class="c1"># 10*dist_mu</span>
    <span class="n">mu_av</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sigma_av</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">theta</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Non-finite parameter:&quot;</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="mi">5</span> <span class="o">&lt;</span> <span class="n">met</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">4000</span> <span class="o">&lt;</span> <span class="n">teff</span> <span class="o">&lt;</span> <span class="mi">6500</span> <span class="ow">and</span> <span class="mf">0.1</span> <span class="o">&lt;</span> <span class="n">rad</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="c1"># Truncated normal on distance</span>
    <span class="n">logp_dist</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">mu_dist</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_dist</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">logp_av</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">Av</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">mu_av</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma_av</span><span class="p">,</span> 
                            <span class="n">lower</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">),</span> <span class="n">upper</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma_av</span> <span class="o">+</span> <span class="n">mu_av</span><span class="p">))</span>
    <span class="n">logp_feh</span> <span class="o">=</span> <span class="n">log_norm</span><span class="p">(</span><span class="n">met</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=-</span><span class="mf">0.125</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.234</span><span class="p">)</span>
    <span class="n">logp_logg</span> <span class="o">=</span> <span class="n">log_truncnorm</span><span class="p">(</span><span class="n">logg</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logp_dist</span> <span class="o">+</span> <span class="n">logp_av</span> <span class="o">+</span> <span class="n">logp_feh</span> <span class="o">+</span> <span class="n">logp_logg</span>


<span class="c1">######################  LOG LIKELIHOOD  ########################</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model_flux_emcee</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    
    <span class="n">residuals</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span> <span class="o">-</span> <span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">residuals</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>



<span class="c1">######################  LOG POSTERIOR  ########################</span>


<span class="k">def</span> <span class="nf">log_posterior</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">log_likelihood</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span><span class="n">sigma</span><span class="p">,</span><span class="n">interpolator</span><span class="p">)</span>


<span class="c1">######################  MODEL TO FIT  ########################</span>


<span class="k">def</span> <span class="nf">model_flux_emcee</span><span class="p">(</span><span class="n">params</span><span class="p">,</span><span class="n">wav</span><span class="p">,</span><span class="n">interpolator</span><span class="p">):</span>
    <span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">Av</span>  <span class="o">=</span> <span class="n">params</span>
    
    <span class="n">model</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">([</span><span class="n">met</span><span class="p">,</span> <span class="n">teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">])</span> 
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">model</span><span class="p">)):</span>
        <span class="k">return</span> <span class="kc">None</span>
    
    <span class="n">model</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">model</span><span class="p">[</span><span class="n">col_to_idx</span><span class="p">[</span><span class="n">b</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">])</span> <span class="c1"># Get the SED in the correct order</span>
    
    <span class="n">r</span> <span class="o">=</span> <span class="n">rad</span> <span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">value</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">pc</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">solRad</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">av_law</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">Av</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">)</span>

    <span class="k">return</span>  <span class="n">apply</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
</div>
<p>We now invoke the sampler using <code class="docutils literal notranslate"><span class="pre">emcee</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Ensure that your starting position is within the bounds of your prior, otherwise the parameter space will not be explored.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">emcee</span> 

<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">nsteps</span> <span class="o">=</span> <span class="mi">25000</span>

<span class="c1">## Define starting position for sampler ##</span>
<span class="n">init_vals</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;met&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;teff&quot;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="s2">&quot;logg&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
    <span class="s2">&quot;rad&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;dist&quot;</span><span class="p">:</span> <span class="n">dist</span><span class="p">,</span>
    <span class="s1">&#39;Av&#39;</span><span class="p">:</span> <span class="mf">0.1</span>
<span class="p">}</span>

<span class="n">param_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;met&quot;</span><span class="p">,</span> <span class="s2">&quot;teff&quot;</span><span class="p">,</span>  <span class="s2">&quot;logg&quot;</span><span class="p">,</span> <span class="s2">&quot;rad&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;Av&quot;</span><span class="p">]</span>
<span class="n">theta_init</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">init_vals</span><span class="p">[</span><span class="n">param</span><span class="p">]</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">param_order</span><span class="p">])</span>

<span class="n">p0</span> <span class="o">=</span> <span class="n">theta_init</span> <span class="o">+</span> <span class="mf">1e-2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_order</span><span class="p">))</span>  <span class="c1">## Starting position</span>

<span class="n">logp_func</span> <span class="o">=</span> <span class="n">log_posterior</span>   <span class="c1">## The log posterior function encapsulates the likelihood and prior</span>
<span class="n">args_func</span> <span class="o">=</span> <span class="p">(</span><span class="n">obs_wav</span><span class="p">,</span> <span class="n">obs_flux</span><span class="p">,</span> <span class="n">obs_flux_err</span><span class="p">,</span> <span class="n">interpolator</span><span class="p">)</span>  <span class="c1">## Additional arguments other than than parameter vector</span>


<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_order</span><span class="p">),</span>
                                <span class="n">logp_func</span><span class="p">,</span>
                                <span class="n">args</span><span class="o">=</span><span class="n">args_func</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running MCMC...&quot;</span><span class="p">)</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">nsteps</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampling complete.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running MCMC...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                                                                  | 9532/25000 [00:58&lt;01:31, 168.91it/s]
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#apparent-magnitudes-and-observed-flux">Apparent magnitudes and observed flux</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#retrieving-apparent-magnitude-measurements">Retrieving apparent magnitude measurements</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-the-observed-photometry-to-synthetic-photometry">Fitting the observed photometry to synthetic photometry</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#grid-parameters">Grid parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-factors">Additional factors</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc-sed-fitting">MCMC SED Fitting</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Marc Hon
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>