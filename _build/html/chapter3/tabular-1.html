

<!DOCTYPE html>


<html data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Grids of Stellar Models Part 1: Stellar Parameter Regression &#8212; AIS 5201: AI In Astrophysics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter3/tabular-1';</script>
    <link rel="canonical" href="https://USER.github.io/REPO/chapter3/tabular-1.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Grids of Stellar Models Part 2: Interpolation" href="tabular-2.html" />
    <link rel="prev" title="Tabular Data" href="section_intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">AIS 5201: AI In Astrophysics</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction to AIS 5201
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter1/section_intro.html">Time-domain Data</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_1.html">Fitting Red Giant Oscillations Part 1: <em>Traditional Optimization</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/fitting_power_spectrum_2.html">Fitting Red Giant Oscillations Part 2: <em>Flows &amp; Simulation-Based Inference</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/ps_statistics.html"><em>Power Spectrum Statistics</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_1.html">Eclipse Morphology Part 1: <em>Exploring and Preparing Data</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_2.html">Eclipse Morphology Part 2: <em>Low-Dimensional Representations</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_3.html">Eclipse Morphology Part 3: <em>Latent Spaces and Visualizing Them</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/eb-morphology_4.html">Eclipse Morphology Part 4: <em>The Variational Autoencoder</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-1.html">Planetary Transits Part 1: <em>Observing Transits</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-2.html">Planetary Transits Part 2: <em>Classifying Transits</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter1/transit-3.html">Planetary Transits Part 3: <em>Fitting a Transit Profile</em></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter2/section_intro.html">Spectra</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/sed-1.html">Spectral Energy Distribution (SED) Part 1: <em>Observing SEDs</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/sed-2.html">Spectral Energy Distribution (SED) Part 2: <em>Fitting SEDs</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/sed-3.html">Spectral Energy Distribution (SED) Part 3: <em>Bayesian Evidence and Model Selection</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/spectra-1.html">Stellar Spectra Part 1: <em>Observing Detailed Spectral Features</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/spectra-2.html">Stellar Spectra Part 2: <em>The Cannon</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/spectra-3.html">Stellar Spectra Part 3: <em>The Payne</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/spectra-4.html">Stellar Spectra Part 4: <em>Detecting Stellar Activity Indicators</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter2/spectra-5.html">Stellar Spectra Part 5: <em>Domain Transfer</em></a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="section_intro.html">Tabular Data</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Grids of Stellar Models Part 1: <em>Stellar Parameter Regression</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="tabular-2.html">Grids of Stellar Models Part 2: <em>Interpolation</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="tabular-3.html">Catalogue Data Part 1: <em>Mixed Data Types</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="tabular-4.html">Catalogue Data Part 2: <em>Finding Clusters and Overdensities</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="tabular-5.html"><em>The Physics Informed Neural Network</em></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter4/section_intro.html">Images</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-1.html">Images Part 1: <em>Galaxy Merger Classification</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-2.html">Images Part 2: <em>Galaxy Morphology Classification</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-3.html">Images Part 3: <em>Self-Supervised Learning</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter4/images-4.html">Images Part 4: <em>Upscaling the Cosmic Web</em></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/executablebooks/jupyter-book/blob/master/docs/chapter3/tabular-1.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/edit/master/docs/chapter3/tabular-1.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter3/tabular-1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter3/tabular-1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Grids of Stellar Models Part 1: Stellar Parameter Regression</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grids-of-evolutionary-tracks-isochrones">Grids of Evolutionary Tracks/Isochrones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-parameters-mathbf-y">Input Parameters, <span class="math notranslate nohighlight">\(\mathbf{y}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observables-mathbf-x">Observables, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-on-a-grid-of-stellar-models">Regression on a Grid of Stellar Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nearest-neighbours-look-up">Nearest Neighbours Look-Up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regression">Random Forest Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature Importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-between-lr-and-rf-feature-importances">Differences between LR and RF feature importances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance-determined-externally-shap">Feature importance determined externally: SHAP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-shap-values">Interpreting SHAP values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See also</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="grids-of-stellar-models-part-1-stellar-parameter-regression">
<span id="content-references-tabular-part1"></span><h1>Grids of Stellar Models Part 1: <em>Stellar Parameter Regression</em><a class="headerlink" href="#grids-of-stellar-models-part-1-stellar-parameter-regression" title="Permalink to this headline">#</a></h1>
<p><em><strong>Author: Marc Hon</strong></em></p>
<p>In this chapter, we will explore the use of machine learning to determine the properties of stars from numerical data extracted from stellar observations.</p>
<section id="grids-of-evolutionary-tracks-isochrones">
<h2>Grids of Evolutionary Tracks/Isochrones<a class="headerlink" href="#grids-of-evolutionary-tracks-isochrones" title="Permalink to this headline">#</a></h2>
<p>Upon obtaining the properties of an astronomical object from observations – be it raw measurements or more refined calculations – the next step in learning further about the observed object
is to connect observations to theory. This often involves comparing these observed quantities with those from theoretical simulations, computed either analytically or numerically.</p>
<p>For stars, comparisons between theory and observations are commonly performed using grids of <strong>evolutionary tracks</strong> and <strong>isochrones</strong>.</p>
<figure class="align-default" id="evol-tracks">
<a class="reference internal image-reference" href="../_images/track_iso.png"><img alt="../_images/track_iso.png" src="../_images/track_iso.png" style="width: 800px; height: 450px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 30 </span><span class="caption-text">Grids of stellar models presented in effective/surface temperature (<span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>) and bolometric luminosity (<span class="math notranslate nohighlight">\(L\)</span>). (<em>Left</em>) Evolutionary tracks from <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/1989A%26A...210..155M/abstract">Maeder A., Meynet G., (1989)</a> (<em>Right</em>) Isochrones from the <a class="reference external" href="https://github.com/astroChasqui/astro101_graphs">Padova stellar evolution code</a>.</span><a class="headerlink" href="#evol-tracks" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>Evolutionary track and isochrones are model-generated sequences that describe stellar properties over time, but they differ in what is held constant:</p>
<ul class="simple">
<li><p>An evolutionary track traces the life of a single star of fixed mass, showing how its properties evolve.</p></li>
<li><p>An isochrone connects models of stars that all share the same age but differ in mass, representing a snapshot in time across different evolutionary stages.</p></li>
</ul>
<p>Each model along a track or isochrone provides a set of stellar properties, which we can broadly divide into two categories:</p>
<ul class="simple">
<li><p><strong>Output Observables</strong>: These are predicted properties of the model that can be directly compared to telescope observations. Examples of these are  <span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>, metallicity [Fe/H], and apparent magnitudes.</p></li>
<li><p><strong>Input Parameters</strong>: These are underlying properties or initial conditions of the model that may only be inferred from model fitting. Examples are stellar ages and initial helium (<span class="math notranslate nohighlight">\(Y\)</span>) and metal (<span class="math notranslate nohighlight">\(Z\)</span>) abundances.</p></li>
</ul>
<p>By finding the Input Parameters whose Output Observables match the observables from data, we may learn about the intrinsic properties of stars – such as their ages, compositions, and evolutionary states.</p>
<p>In this Exercise, we are going to investigate this task on a grid of stellar models having photometric, spectroscopic, and asteroseismic observables from <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016ApJ...830...31B/abstract">Bellinger et al. (2016)</a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">corner</span>
<span class="kn">import</span> <span class="nn">scienceplots</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">astropy.constants</span> <span class="k">as</span> <span class="nn">const</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">coordinates</span> <span class="k">as</span> <span class="n">coords</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">truncnorm</span><span class="p">,</span> <span class="n">norm</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;science&#39;</span><span class="p">);</span> <span class="n">fs</span><span class="o">=</span><span class="mi">15</span>

<span class="n">data_folder_path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;ml_astro&#39;</span> <span class="o">/</span> <span class="s1">&#39;chapter3&#39;</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_folder_path</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/simulations.csv&#39;</span><span class="p">)</span>
<span class="n">sim_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>M</th>
      <th>Y</th>
      <th>Z</th>
      <th>alpha</th>
      <th>overshoot</th>
      <th>diffusion</th>
      <th>age</th>
      <th>radius</th>
      <th>L</th>
      <th>log_g</th>
      <th>Teff</th>
      <th>Fe/H</th>
      <th>Dnu0</th>
      <th>dnu02</th>
      <th>r02</th>
      <th>X_c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.700137</td>
      <td>0.236000</td>
      <td>0.000323</td>
      <td>1.726654</td>
      <td>0.002538</td>
      <td>19.077329</td>
      <td>0.000000</td>
      <td>0.590223</td>
      <td>0.325432</td>
      <td>4.741384</td>
      <td>5680.219262</td>
      <td>-1.734798</td>
      <td>248.486628</td>
      <td>19.935655</td>
      <td>0.080239</td>
      <td>0.763127</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.700137</td>
      <td>0.236000</td>
      <td>0.000323</td>
      <td>1.726654</td>
      <td>0.002538</td>
      <td>19.077329</td>
      <td>3.067329</td>
      <td>0.675168</td>
      <td>0.400312</td>
      <td>4.624592</td>
      <td>5593.088762</td>
      <td>-2.162580</td>
      <td>203.515485</td>
      <td>14.853297</td>
      <td>0.072778</td>
      <td>0.521957</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.700137</td>
      <td>0.236000</td>
      <td>0.000323</td>
      <td>1.726654</td>
      <td>0.002538</td>
      <td>19.077329</td>
      <td>6.168685</td>
      <td>0.764955</td>
      <td>0.535708</td>
      <td>4.516143</td>
      <td>5651.606420</td>
      <td>-2.533137</td>
      <td>169.508823</td>
      <td>8.951604</td>
      <td>0.052694</td>
      <td>0.272175</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.700137</td>
      <td>0.236000</td>
      <td>0.000323</td>
      <td>1.726654</td>
      <td>0.002538</td>
      <td>19.077329</td>
      <td>10.172691</td>
      <td>0.979607</td>
      <td>0.927548</td>
      <td>4.301312</td>
      <td>5728.833358</td>
      <td>-2.927997</td>
      <td>117.043200</td>
      <td>4.808962</td>
      <td>0.040707</td>
      <td>0.036894</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.700192</td>
      <td>0.331998</td>
      <td>0.000032</td>
      <td>1.836090</td>
      <td>0.036713</td>
      <td>0.000811</td>
      <td>2.100065</td>
      <td>0.649650</td>
      <td>0.650736</td>
      <td>4.658091</td>
      <td>6438.274905</td>
      <td>-2.680063</td>
      <td>211.186402</td>
      <td>17.229291</td>
      <td>0.081523</td>
      <td>0.518313</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>13659</th>
      <td>1.599313</td>
      <td>0.302350</td>
      <td>0.008052</td>
      <td>2.397614</td>
      <td>0.193854</td>
      <td>0.037411</td>
      <td>0.253083</td>
      <td>1.383068</td>
      <td>11.387258</td>
      <td>4.360479</td>
      <td>9024.872970</td>
      <td>-2.011042</td>
      <td>92.109718</td>
      <td>10.484210</td>
      <td>0.113756</td>
      <td>0.600678</td>
    </tr>
    <tr>
      <th>13660</th>
      <td>1.599313</td>
      <td>0.302350</td>
      <td>0.008052</td>
      <td>2.397614</td>
      <td>0.193854</td>
      <td>0.037411</td>
      <td>0.741981</td>
      <td>1.697078</td>
      <td>13.702543</td>
      <td>4.182762</td>
      <td>8533.111302</td>
      <td>-4.391204</td>
      <td>69.449754</td>
      <td>6.354993</td>
      <td>0.091851</td>
      <td>0.381710</td>
    </tr>
    <tr>
      <th>13661</th>
      <td>1.599698</td>
      <td>0.311761</td>
      <td>0.003126</td>
      <td>2.324799</td>
      <td>0.000000</td>
      <td>0.000307</td>
      <td>0.092690</td>
      <td>1.170153</td>
      <td>14.413447</td>
      <td>4.505785</td>
      <td>10407.075842</td>
      <td>-0.708765</td>
      <td>114.582085</td>
      <td>13.832250</td>
      <td>0.123651</td>
      <td>0.638902</td>
    </tr>
    <tr>
      <th>13662</th>
      <td>1.599698</td>
      <td>0.311761</td>
      <td>0.003126</td>
      <td>2.324799</td>
      <td>0.000000</td>
      <td>0.000307</td>
      <td>0.449779</td>
      <td>1.364450</td>
      <td>17.325731</td>
      <td>4.372355</td>
      <td>10091.415115</td>
      <td>-0.705940</td>
      <td>90.484944</td>
      <td>9.093502</td>
      <td>0.101327</td>
      <td>0.422676</td>
    </tr>
    <tr>
      <th>13663</th>
      <td>1.599698</td>
      <td>0.311761</td>
      <td>0.003126</td>
      <td>2.324799</td>
      <td>0.000000</td>
      <td>0.000307</td>
      <td>0.685712</td>
      <td>1.632339</td>
      <td>19.961129</td>
      <td>4.216650</td>
      <td>9558.705441</td>
      <td>-0.714391</td>
      <td>70.037146</td>
      <td>6.491789</td>
      <td>0.093430</td>
      <td>0.203510</td>
    </tr>
  </tbody>
</table>
<p>13664 rows × 16 columns</p>
</div></div></div>
</div>
<section id="input-parameters-mathbf-y">
<h3>Input Parameters, <span class="math notranslate nohighlight">\(\mathbf{y}\)</span><a class="headerlink" href="#input-parameters-mathbf-y" title="Permalink to this headline">#</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Column</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">M</span></code></p></td>
<td><p>Initial stellar mass (in solar masses, <span class="math notranslate nohighlight">\(M_\odot\)</span>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Y</span></code></p></td>
<td><p>Initial helium mass fraction</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Z</span></code></p></td>
<td><p>Initial metallicity (mass fraction of elements heavier than helium)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code></p></td>
<td><p>Mixing-length parameter for convection, <span class="math notranslate nohighlight">\(\alpha\)</span> (dimensionless)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">overshoot</span></code></p></td>
<td><p>Extent of convective overshooting beyond the core (in pressure scale heights)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">diffusion</span></code></p></td>
<td><p>Efficiency parameter for microscopic diffusion (dimensionless or flag)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">age</span></code></p></td>
<td><p>Stellar age (in Gyr)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">radius</span></code></p></td>
<td><p>Stellar radius (in solar radii, <span class="math notranslate nohighlight">\(R_\odot\)</span>)</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sim_df</span><span class="p">[</span><span class="s1">&#39;log_Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sim_df</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">sim_df</span><span class="p">[</span><span class="s1">&#39;log_overshoot&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sim_df</span><span class="o">.</span><span class="n">overshoot</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
<span class="n">sim_df</span><span class="p">[</span><span class="s1">&#39;log_diffusion&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sim_df</span><span class="o">.</span><span class="n">diffusion</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">overshoot</span></code> and <code class="docutils literal notranslate"><span class="pre">diffusion</span></code> parameters are customarily set to <code class="docutils literal notranslate"><span class="pre">0</span></code> to indicate that such settings are turned off in particular models, i.e., the models have no convective overshooting and/or microsopic diffusion. Because these values are distributed logarithmically otherwise, adding a small offset such as <code class="docutils literal notranslate"><span class="pre">1e-6</span></code> mitigates issues with visualizing the logarithm of their distributions.</p>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;log_Z&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;log_overshoot&#39;</span><span class="p">,</span> <span class="s1">&#39;log_diffusion&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">sim_df</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Pandas support in corner is deprecated; use ArviZ directly
</pre></div>
</div>
<img alt="../_images/d1f8ebae4a44b7c3678e611464ba715b88bb60bb1629b27932f17d7576eadadc.png" src="../_images/d1f8ebae4a44b7c3678e611464ba715b88bb60bb1629b27932f17d7576eadadc.png" />
</div>
</div>
</section>
<section id="observables-mathbf-x">
<h3>Observables, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span><a class="headerlink" href="#observables-mathbf-x" title="Permalink to this headline">#</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Column</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">L</span></code></p></td>
<td><p>Stellar luminosity (in solar luminosities, <span class="math notranslate nohighlight">\(L_\odot\)</span>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log_g</span></code></p></td>
<td><p>Surface gravity (logarithmic, in cgs units)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Teff</span></code></p></td>
<td><p>Effective temperature (in Kelvin)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Fe/H</span></code></p></td>
<td><p>Surface iron abundance relative to solar (<span class="math notranslate nohighlight">\([\mathrm{Fe}/\mathrm{H}]\)</span>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Dnu0</span></code></p></td>
<td><p>Large frequency separation of radial modes (<span class="math notranslate nohighlight">\(\mu\)</span>Hz), linked to mean density</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">dnu02</span></code></p></td>
<td><p>Small frequency separation between <span class="math notranslate nohighlight">\(\ell = 0\)</span> and <span class="math notranslate nohighlight">\(\ell = 2\)</span> modes (<span class="math notranslate nohighlight">\(\mu\)</span>Hz)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">r02</span></code></p></td>
<td><p>Frequency ratio: <span class="math notranslate nohighlight">\(r_{02} = \frac{\nu_{n,0} - \nu_{n-1,2}}{\nu_{n,1} - \nu_{n-1,1}}\)</span>, sensitive to core structure</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">X_c</span></code></p></td>
<td><p>Central hydrogen mass fraction, indicating evolutionary state</p></td>
</tr>
</tbody>
</table>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;log_g&#39;</span><span class="p">,</span> <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe/H&#39;</span><span class="p">,</span> <span class="s1">&#39;Dnu0&#39;</span><span class="p">,</span> <span class="s1">&#39;dnu02&#39;</span><span class="p">,</span> <span class="s1">&#39;r02&#39;</span><span class="p">,</span> <span class="s1">&#39;X_c&#39;</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">sim_df</span><span class="p">[</span><span class="n">labels</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING:root:Pandas support in corner is deprecated; use ArviZ directly
</pre></div>
</div>
<img alt="../_images/9285b5f3d29d8d477d9ff2f2bfab363931e4f71ff54da5a272bcfb7acc9f9bea.png" src="../_images/9285b5f3d29d8d477d9ff2f2bfab363931e4f71ff54da5a272bcfb7acc9f9bea.png" />
</div>
</div>
</section>
</section>
<section id="regression-on-a-grid-of-stellar-models">
<h2>Regression on a Grid of Stellar Models<a class="headerlink" href="#regression-on-a-grid-of-stellar-models" title="Permalink to this headline">#</a></h2>
<p>The key task in stellar modeling is the following:</p>
<blockquote>
<div><p>Given a set of output observables <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> from data, determine the model input parameters <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> that produce observables most consistent with <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>.</p>
</div></blockquote>
<p>This amounts to identifying the model that best explains the data from the grid. The simplest way of attempting this would be to treat the grid of models as a <strong>look-up table</strong>.</p>
<section id="nearest-neighbours-look-up">
<h3>Nearest Neighbours Look-Up<a class="headerlink" href="#nearest-neighbours-look-up" title="Permalink to this headline">#</a></h3>
<p>For this exercise, let’s apply <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>’s <code class="docutils literal notranslate"><span class="pre">NearestNeighbors</span></code> module, which uses a Euclidean distance metric to measure the proximity of input data to the grid of models. First, let us pre-process the grid of models as a training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Observables (features)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sim_df</span><span class="p">[[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;log_g&#39;</span><span class="p">,</span> <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe/H&#39;</span><span class="p">,</span> <span class="s1">&#39;Dnu0&#39;</span><span class="p">,</span> <span class="s1">&#39;dnu02&#39;</span><span class="p">,</span> <span class="s1">&#39;r02&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Target physical parameters (labels)</span>
<span class="n">y_</span> <span class="o">=</span> <span class="n">sim_df</span><span class="p">[[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;overshoot&#39;</span><span class="p">,</span> <span class="s1">&#39;diffusion&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;radius&#39;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y_</span><span class="o">.</span><span class="n">values</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span> <span class="c1"># standard scaling the observables</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="important admonition">
<p class="admonition-title">Standard scaling for nearest neighbors lookup</p>
<p>Is the application of feature scaling for <code class="docutils literal notranslate"><span class="pre">X</span></code> important to correctly find the nearest neighbour model from the grid?</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>

<span class="n">nn</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">nn_distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_pred_nn</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span> 
</pre></div>
</div>
</div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">indices</span></code> corresponds to the indices of the closest matching model in the grid (<code class="docutils literal notranslate"><span class="pre">y_train</span></code>). We have effectively assigned actual models in the grid as predictions. Let’s observe its predictive power.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="n">mae_nn</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_nn</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>
<span class="n">r2_nn</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_nn</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">mae_nn</span><span class="p">,</span> <span class="n">r2_nn</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> R2: </span><span class="si">{</span><span class="n">rr</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE for M: 0.0592 	 R2: 0.9069
MAE for Y: 0.0324 	 R2: -0.3895
MAE for Z: 0.0027 	 R2: 0.9247
MAE for alpha: 0.2794 	 R2: -0.4995
MAE for overshoot: 0.1197 	 R2: -0.4339
MAE for diffusion: 2.9787 	 R2: -0.0368
MAE for age: 0.5594 	 R2: 0.8567
MAE for radius: 0.0285 	 R2: 0.9804
</pre></div>
</div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Understanding the R² Score</p>
<p>The <strong>R² score</strong>, also known as the <em>coefficient of determination</em>, is a common metric used to evaluate regression models. It provides a measure of how well the model’s predictions approximate the true data.</p>
<p>Mathematically, it is defined as:</p>
<div class="math notranslate nohighlight">
\[
R^2 = 1 - \frac{\sum_i (y_i - \hat{y}_i)^2}{\sum_i (y_i - \bar{y})^2}
\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( y_i \)</span> are the true values,</p></li>
<li><p><span class="math notranslate nohighlight">\( \hat{y}_i \)</span> are the predicted values,</p></li>
<li><p><span class="math notranslate nohighlight">\( \bar{y} \)</span> is the mean of the true values.</p></li>
</ul>
<p class="rubric">Key Interpretations:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( R^2 = 1 \)</span>: Perfect prediction — the model explains all variability in the data.</p></li>
<li><p><span class="math notranslate nohighlight">\( R^2 = 0 \)</span>: The model performs no better than simply predicting the mean of the target variable.</p></li>
</ul>
<p>Following the above definition, what would a <strong>negative R²</strong> indicate?</p>
</div>
</section>
<section id="linear-regression">
<h3>Linear Regression<a class="headerlink" href="#linear-regression" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">y_pred_nn</span></code> uses no learning and merely does a retrieval. Let’s observe a predictive performance using a global linear mapping:</p>
<div class="math notranslate nohighlight">
\[
\mathbf{y} = \mathbf{X}\cdot \beta,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta\)</span> are linear regression coefficients.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">y_pred_lr</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mae_lr</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_lr</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>
<span class="n">r2_lr</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_lr</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">mae_lr</span><span class="p">,</span> <span class="n">r2_lr</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> </span><span class="se">\t</span><span class="s2"> R2: </span><span class="si">{</span><span class="n">rr</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE for M: 0.0765 	 R2: 0.8532
MAE for Y: 0.0269 	 R2: 0.1331
MAE for Z: 0.0097 	 R2: 0.6648
MAE for alpha: 0.2421 	 R2: 0.0299
MAE for overshoot: 0.1151 	 R2: 0.0533
MAE for diffusion: 4.5010 	 R2: 0.1438
MAE for age: 1.1610 	 R2: 0.7034
MAE for radius: 0.0537 	 R2: 0.9449
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span> 
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">label_nn</span> <span class="o">=</span> <span class="s1">&#39;Nearest Neighbour&#39;</span>
        <span class="n">label_lr</span> <span class="o">=</span> <span class="s1">&#39;Linear Regression&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_nn</span> <span class="o">=</span> <span class="n">label_lr</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pred_nn</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_nn</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pred_lr</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_lr</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">])],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">])],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.105</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="o">+</span><span class="mi">5</span><span class="p">});</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/d938a3772748d8832545e60e03434c134b8b0e2143a471d47e856d20332b9eb2.png" src="../_images/d938a3772748d8832545e60e03434c134b8b0e2143a471d47e856d20332b9eb2.png" />
</div>
</div>
<div class="important admonition">
<p class="admonition-title">Prediction behaviour and R² Score</p>
<p>Explain the behaviour of the the <span class="math notranslate nohighlight">\(Y\)</span> and <span class="math notranslate nohighlight">\(\alpha\)</span> predictions from the linear regression and nearest neighbour models in relation to their R² scores. In particular,</p>
<ul class="simple">
<li><p>Why are the predicted values dispersed across the full parameter range for the nearest neighbour model?</p></li>
<li><p>Why are the predicted values concentrated within a narrow band of values for the linear regression model?</p></li>
</ul>
</div>
</section>
<section id="random-forest-regression">
<h3>Random Forest Regression<a class="headerlink" href="#random-forest-regression" title="Permalink to this headline">#</a></h3>
<p>Given that the relationship between features and targets is non-linear or complex, we may use a more sophisticated model in the form of random forests to perform the regression task.</p>
<p>A Random Forest builds many decision trees, each trained on a random subset of the data. The regression prediction is the average of all individual tree outputs:</p>
<div class="math notranslate nohighlight">
\[
\hat{y}_{\text{RF}}(\mathbf{x}) = \frac{1}{T} \sum_{t=1}^{T} \hat{y}_t(\mathbf{x})
\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\( T \)</span> is the total number of trees,</p></li>
<li><p><span class="math notranslate nohighlight">\( \hat{y}_t(\mathbf{x}) \)</span> is the prediction from the <span class="math notranslate nohighlight">\( t \)</span>-th tree for input <span class="math notranslate nohighlight">\( \mathbf{x} \)</span>.</p></li>
</ul>
<p>Each decision tree splits the feature space into regions based on thresholds that minimize the loss (e.g., mean squared error (MSE), and at each leaf node, the predicted value is simply the mean of the training targets that fall into that region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>

<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">y_pred_rf</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="n">mae_rf</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_rf</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>
<span class="n">r2_rf</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_rf</span><span class="p">,</span> <span class="n">multioutput</span><span class="o">=</span><span class="s1">&#39;raw_values&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">mae_rf</span><span class="p">,</span> <span class="n">r2_rf</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE for </span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">  </span><span class="se">\t</span><span class="s2"> R2: </span><span class="si">{</span><span class="n">rr</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE for M: 0.0491  	 R2: 0.9388
MAE for Y: 0.0266  	 R2: 0.1489
MAE for Z: 0.0024  	 R2: 0.9487
MAE for alpha: 0.2181  	 R2: 0.1643
MAE for overshoot: 0.1066  	 R2: 0.1739
MAE for diffusion: 2.4847  	 R2: 0.4773
MAE for age: 0.4423  	 R2: 0.9053
MAE for radius: 0.0267  	 R2: 0.9547
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span> 
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">label_lr</span> <span class="o">=</span> <span class="s1">&#39;Linear Regression&#39;</span>
        <span class="n">label_rf</span> <span class="o">=</span> <span class="s1">&#39;Random Forests&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">label_lr</span> <span class="o">=</span> <span class="n">label_rf</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pred_lr</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_lr</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_pred_rf</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_rf</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">])],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_test</span><span class="p">[:,</span><span class="n">i</span><span class="p">])],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.105</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">fs</span><span class="o">+</span><span class="mi">5</span><span class="p">});</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/4e59e0716fcc184e964e2d3103ffd29e9c11a683dabda71618655e5a5d611a3e.png" src="../_images/4e59e0716fcc184e964e2d3103ffd29e9c11a683dabda71618655e5a5d611a3e.png" />
</div>
</div>
<p>The use of an algorithm that is capable of dealing with non-linear relationships in the data evidently better suited for predicting relationships involved in stellar evolution!</p>
</section>
</section>
<section id="feature-importances">
<h2>Feature Importances<a class="headerlink" href="#feature-importances" title="Permalink to this headline">#</a></h2>
<p>In machine learning regression tasks, not all input features contribute equally to predicting the outputs. Some features may be highly informative for a given target variable, while others may be only weakly correlated or even irrelevant.</p>
<p>Understanding feature importances helps us interpret the behaviour of the machine learning algorithm, identify redundancies in the input space, and potentially improve predictive performance through feature selection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.multioutput</span> <span class="kn">import</span> <span class="n">MultiOutputRegressor</span>

<span class="c1">## To view the RF importance for EACH parameter, we need to wrap the RF in scikit-learn&#39;s MultiOutputRegressor</span>
<span class="n">multi_rf</span> <span class="o">=</span> <span class="n">MultiOutputRegressor</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span>
<span class="n">multi_rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-3 {color: black;}#sk-container-id-3 pre{padding: 0;}#sk-container-id-3 div.sk-toggleable {background-color: white;}#sk-container-id-3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-3 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-3 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-3 div.sk-item {position: relative;z-index: 1;}#sk-container-id-3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-3 div.sk-item::before, #sk-container-id-3 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-3 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-3 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-3 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-3 div.sk-label-container {text-align: center;}#sk-container-id-3 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-3 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-3" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>MultiOutputRegressor(estimator=RandomForestRegressor(n_estimators=200,
                                                     n_jobs=-1,
                                                     random_state=42))</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" ><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">MultiOutputRegressor</label><div class="sk-toggleable__content"><pre>MultiOutputRegressor(estimator=RandomForestRegressor(n_estimators=200,
                                                     n_jobs=-1,
                                                     random_state=42))</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" ><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(n_estimators=200, n_jobs=-1, random_state=42)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-5" type="checkbox" ><label for="sk-estimator-id-5" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor(n_estimators=200, n_jobs=-1, random_state=42)</pre></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compare_importances</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">),</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">sim_df</span><span class="p">[[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;log_g&#39;</span><span class="p">,</span> <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe/H&#39;</span><span class="p">,</span> <span class="s1">&#39;Dnu0&#39;</span><span class="p">,</span> <span class="s1">&#39;dnu02&#39;</span><span class="p">,</span> <span class="s1">&#39;r02&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">importances_lr</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">sim_df</span><span class="p">[[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;log_g&#39;</span><span class="p">,</span> <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe/H&#39;</span><span class="p">,</span> <span class="s1">&#39;Dnu0&#39;</span><span class="p">,</span> <span class="s1">&#39;dnu02&#39;</span><span class="p">,</span> <span class="s1">&#39;r02&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
             <span class="n">importances_rf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Feature importance&quot;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Feature importance&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Random Forest Feature Importance&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Linear Regression Feature Importance&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Importance For</span><span class="se">\n</span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">]]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">importances_rf</span> <span class="o">=</span> <span class="n">multi_rf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">importances_lr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lr</span><span class="o">.</span><span class="n">coef_</span><span class="p">)[</span><span class="n">idx</span><span class="p">]</span>

<span class="n">compare_importances</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e8febd5e623fda6647deaaf2d8c7b12c1936695cdbf636c07e4428e4843d14b3.png" src="../_images/e8febd5e623fda6647deaaf2d8c7b12c1936695cdbf636c07e4428e4843d14b3.png" />
</div>
</div>
<p>Do the feature importances make sense? It seems to be the case for random forests: the importance for mass (<code class="docutils literal notranslate"><span class="pre">idx</span> <span class="pre">=</span> <span class="pre">0</span></code>) agrees with expectations of a <a class="reference external" href="https://en.wikipedia.org/wiki/Mass%E2%80%93luminosity_relation">mass-luminosity relation</a> for main-sequence stars, which are those used in our grid of models. Meanwhile, the importance for <span class="math notranslate nohighlight">\(Z\)</span> is heavily skewed towards metallicity [Fe/H], which makes sense: surely a star that has a higher metallicity should have had a higher initial metal fraction than those with lower metallicities!</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Observe the differences in feature importances for parameters that can be predicted fairly accurately (e.g., <span class="math notranslate nohighlight">\(M\)</span> and <span class="math notranslate nohighlight">\(Z\)</span>) versus those with low prediction accuracy (e.g., diffusion, <span class="math notranslate nohighlight">\(\alpha\)</span>).</p>
</div>
<p>However, qualitatively, we will find that the relative importances for linear regression (LR) will consistently differ from those provided by random forests (RF). Why?</p>
<section id="differences-between-lr-and-rf-feature-importances">
<h3>Differences between LR and RF feature importances<a class="headerlink" href="#differences-between-lr-and-rf-feature-importances" title="Permalink to this headline">#</a></h3>
<p>The linear regression feature importance relies on the magnitude of the linear coefficients <span class="math notranslate nohighlight">\(\mathbf{\beta}\)</span>. Larger coefficients indicate a feature has a larger influence on the output, but only <strong>linearly</strong>.
Implicit for LR is the assumption that features are independent of one another, which thus <strong>ignores non-linear relations</strong>.</p>
<p>Random forests, on the other hand, determine feature importance is computed by calculating the <strong>total decrease in prediction error or impurity</strong> from each feature across all trees. Specifically:</p>
<ol class="arabic simple">
<li><p>Every time a feature is used to split a node, it contributes to reducing the impurity.</p></li>
<li><p>This contribution is weighted by the number of samples reaching the node.</p></li>
<li><p>The importance for each feature is summed over all trees in the forest, and then normalized.</p></li>
</ol>
<p>Therefore, RF tells you how useful each feature is in reducing error <strong>through any number of nonlinear paths</strong>.</p>
</section>
<section id="feature-importance-determined-externally-shap">
<h3>Feature importance determined externally: SHAP<a class="headerlink" href="#feature-importance-determined-externally-shap" title="Permalink to this headline">#</a></h3>
<p>Recent external approaches have been developed to explain the output of any machine learning model by assigning each feature an importance value. One such example is <strong>SHAP</strong> <a class="reference external" href="https://shap.readthedocs.io/en/latest/">(SHapley Additive exPlanations)</a>.
It is based on Shapley values from cooperative game theory. More specifically, each feature is treated like a “player” in a game that contributes to a prediction. SHAP computes how much each feature contributes to the prediction, averaged over <strong>all possible combinations of feature presence/absence</strong>.</p>
<p>Let’s examine the use of SHAP over our existing algorithms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shap</span>

<span class="n">feat_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;log_g&#39;</span><span class="p">,</span> <span class="s1">&#39;Teff&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe/H&#39;</span><span class="p">,</span> <span class="s1">&#39;Dnu0&#39;</span><span class="p">,</span> <span class="s1">&#39;dnu02&#39;</span><span class="p">,</span> <span class="s1">&#39;r02&#39;</span><span class="p">]</span>

<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">multi_rf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">X_train</span><span class="p">,</span>
                           <span class="n">feature_names</span><span class="o">=</span> <span class="n">feat_names</span><span class="p">)</span>
<span class="n">X_test_explain</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[::</span><span class="mi">10</span><span class="p">]</span>

<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="p">(</span><span class="n">X_test_explain</span><span class="p">)</span>
<span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">beeswarm</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SHAP Summary for </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2"> on Hold-out (Test) Set&quot;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 96%|=================== | 263/274 [00:14&lt;00:00]       
</pre></div>
</div>
<img alt="../_images/a2f6fafd7d320a05ee7f8ae6f9f38dc441098d60ce3237567f1185d828e21f12.png" src="../_images/a2f6fafd7d320a05ee7f8ae6f9f38dc441098d60ce3237567f1185d828e21f12.png" />
</div>
</div>
<p>In the above, we are showing the SHAP values of features for a particular predicted parameter across the test set, where each point represents a test example.</p>
</section>
<section id="interpreting-shap-values">
<h3>Interpreting SHAP values<a class="headerlink" href="#interpreting-shap-values" title="Permalink to this headline">#</a></h3>
<p>SHAP assigns each input feature an importance value for a particular prediction, reflecting how much that feature contributed (either positively or negatively) to the final model output:</p>
<div class="math notranslate nohighlight">
\[
f(x) = \phi_0 + \sum_{i=1}^M \phi_i,
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(f(x)\)</span>: the model’s prediction for input <span class="math notranslate nohighlight">\(x\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\phi_0\)</span> : the baseline prediction, i.e., the expected model output when no features are known, i.e., the mean over the training set</p></li>
<li><p><span class="math notranslate nohighlight">\(\phi_i\)</span>: the SHAP value for feature <span class="math notranslate nohighlight">\(i\)</span>, indicating its marginal contribution to this prediction</p></li>
</ul>
<p><strong>Key Insight</strong></p>
<blockquote>
<div><p>The Shapley value is the average of all the marginal contributions to all possible combinations of features.</p>
</div></blockquote>
<p>More concretely, assume our subset of features, <span class="math notranslate nohighlight">\(S\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
S=[\log ⁡g,  \text{[Fe/H]},  \Delta\nu_0,  T_{\mathrm{eff}}],
\]</div>
<p>and we want to estimate the marginal contribution of <span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span> to the model’s prediction for stellar age. SHAP performs the following:</p>
<ol class="arabic simple">
<li><p>Fix the known features (<span class="math notranslate nohighlight">\(\log ⁡g,  \text{[Fe/H]},  \Delta\nu_0\)</span>) to their values in the target star.</p></li>
<li><p>Sample multiple plausible values of <span class="math notranslate nohighlight">\(T_{\mathrm{eff}\)</span> from the background grid of stellar models.</p></li>
<li><p>Use each sampled value of <span class="math notranslate nohighlight">\(T_{\mathrm{eff}\)</span> together with the fixed values of the known features to evaluate the model’s predicted age.</p></li>
<li><p>Average these predictions to estimate the expected prediction without <span class="math notranslate nohighlight">\(T_{\mathrm{eff}\)</span>, namely <span class="math notranslate nohighlight">\(\mathbb{E}[f(x) | \)</span>\log ⁡g,  \text{[Fe/H]},  \Delta\nu_0]$</p></li>
</ol>
<p>The marginal contribution for <span class="math notranslate nohighlight">\(T_{\mathrm{eff}}\)</span>, <span class="math notranslate nohighlight">\(\phi_{T_{\mathrm{eff}}}\)</span> is thus:</p>
<div class="math notranslate nohighlight">
\[
\phi_{T_{\mathrm{eff}}} = \mathbb{E}[f(x) | \log ⁡g,  \text{[Fe/H]},  \Delta\nu_0, T_{\mathrm{eff}}]− \mathbb{E}[f(x) | \log ⁡g,  \text{[Fe/H]},  \Delta\nu_0].
\]</div>
<p><strong>The marginal contribution needs to be averaged across all feature permutations</strong>, for instance:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\([\log ⁡g,  \text{[Fe/H]},  \Delta\nu_0, T_{\mathrm{eff}}]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\([\text{[Fe/H]}, \log ⁡g,  \Delta\nu_0, T_{\mathrm{eff}}]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\([\text{[Fe/H]}, \Delta\nu_0, \log ⁡g,  T_{\mathrm{eff}}]\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\([T_{\mathrm{eff}}, \log ⁡g,  \text{[Fe/H]},  \Delta\nu_0]\)</span>
…</p></li>
</ul>
<p>and so on.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">shap_waterfall</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">entry_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">shap_values</span><span class="o">.</span><span class="n">values</span>
    <span class="n">base_value</span> <span class="o">=</span> <span class="n">shap_values</span><span class="o">.</span><span class="n">base_values</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">shap_values</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># Sort by absolute SHAP value (importance)</span>
    <span class="n">idx_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">values</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="n">max_display</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">idx_sorted</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">idx_sorted</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">feature_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Feature </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_names</span><span class="p">)[</span><span class="n">idx_sorted</span><span class="p">]</span>

    <span class="c1"># Compute cumulative contributions</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">base_value</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">cumulative</span> <span class="o">=</span> <span class="p">[</span><span class="n">base_value</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">cumulative</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cumulative</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">cumulative</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span>

    <span class="c1"># Setup plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))))</span>

    <span class="c1"># Bars</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">left</span><span class="o">=</span><span class="n">cumulative</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        
    <span class="c1"># Labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">data</span><span class="p">)])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">base_value</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Background prediction&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Model output&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SHAP Waterfall Plot for </span><span class="si">{</span><span class="n">y_</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="si">}</span><span class="s2">, Test Example </span><span class="si">{</span><span class="n">entry_idx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">entry_idx</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">shap_waterfall</span><span class="p">(</span><span class="n">shap_values</span><span class="p">[</span><span class="n">entry_idx</span><span class="p">],</span> <span class="n">entry_idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">feat_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a26203d7dac93b80e8566a23b5ea360774e1ce24a46fc416d721c3a2ced4ff1c.png" src="../_images/a26203d7dac93b80e8566a23b5ea360774e1ce24a46fc416d721c3a2ced4ff1c.png" />
</div>
</div>
<div class="info admonition">
<p class="admonition-title">Reading the waterfall plot</p>
<p>The features are sorted from bottom to top, most important first. Beginning at the background prediction, the most important feature increments (green) or decrements (red) the model output to a certain value. From this value, the next most important feature moves the model output based on its SHAP value. This proceeds until all features have been considered, arriving at the blue line.</p>
</div>
<p>We can verify that the sum of SHAP values for each feature is equal to the prediction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Base Value: </span><span class="si">{</span><span class="n">shap_values</span><span class="p">[</span><span class="n">entry_idx</span><span class="p">]</span><span class="o">.</span><span class="n">base_values</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">tot_shap</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">feat</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">feat_names</span><span class="p">,</span> <span class="n">shap_values</span><span class="p">[</span><span class="n">entry_idx</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">feat</span><span class="si">}</span><span class="s1"> SHAP Value: </span><span class="si">{</span><span class="n">val</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">tot_shap</span> <span class="o">+=</span> <span class="n">val</span>
    
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Base Value + All SHAP Values: </span><span class="si">{</span><span class="p">(</span><span class="n">shap_values</span><span class="p">[</span><span class="n">entry_idx</span><span class="p">]</span><span class="o">.</span><span class="n">base_values</span> <span class="o">+</span> <span class="n">tot_shap</span><span class="p">)</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted Value: </span><span class="si">{</span><span class="n">multi_rf</span><span class="o">.</span><span class="n">estimators_</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_explain</span><span class="p">)[</span><span class="n">entry_idx</span><span class="p">]</span><span class="si">:</span><span class="s1">.5f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Base Value: 0.01409

L SHAP Value: 0.00039
log_g SHAP Value: 0.00182
Teff SHAP Value: -0.00199
Fe/H SHAP Value: -0.01127
Dnu0 SHAP Value: 0.00070
dnu02 SHAP Value: -0.00102
r02 SHAP Value: -0.00037

Base Value + All SHAP Values: 0.00236
Predicted Value: 0.00236
</pre></div>
</div>
</div>
</div>
<div class="important admonition">
<p class="admonition-title">Exercise: Leave One Feature Out (LOFO) Importance</p>
<p>A simple approach for calculating the importance for a feature is to retrain the algorithm without a particular feature and reassessing the resulting performance.</p>
<ol class="arabic simple">
<li><p>Using the <strong>grid lookup algorithm</strong> (i.e., <code class="docutils literal notranslate"><span class="pre">NearestNeighbors</span></code>), calculate the LOFO importance for a particular predicted output variable. You may use the <strong>mean absolute error (MAE)</strong> or the <strong>R² score</strong> as your metric.</p>
<ul class="simple">
<li><p>How does the LOFO importance compare to the feature importances computed previously using <strong>linear regression</strong> and <strong>random forests</strong>?</p></li>
</ul>
</li>
<li><p>Using LOFO on the <strong>lookup-based model</strong>, calculate the importances <strong>for each feature in a specific test point</strong>.</p>
<ul class="simple">
<li><p>How do these <em>local LOFO importances</em> compare with the <strong>SHAP values</strong> computed for the same prediction?</p></li>
</ul>
</li>
</ol>
</div>
</section>
</section>
<section id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://christophm.github.io/interpretable-ml-book/shapley.html">Interpretable Machine Learning</a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="section_intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tabular Data</p>
      </div>
    </a>
    <a class="right-next"
       href="tabular-2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Grids of Stellar Models Part 2: <em>Interpolation</em></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grids-of-evolutionary-tracks-isochrones">Grids of Evolutionary Tracks/Isochrones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-parameters-mathbf-y">Input Parameters, <span class="math notranslate nohighlight">\(\mathbf{y}\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observables-mathbf-x">Observables, <span class="math notranslate nohighlight">\(\mathbf{x}\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-on-a-grid-of-stellar-models">Regression on a Grid of Stellar Models</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nearest-neighbours-look-up">Nearest Neighbours Look-Up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-regression">Linear Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-regression">Random Forest Regression</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importances">Feature Importances</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#differences-between-lr-and-rf-feature-importances">Differences between LR and RF feature importances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance-determined-externally-shap">Feature importance determined externally: SHAP</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-shap-values">Interpreting SHAP values</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#see-also">See also</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Marc Hon
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>